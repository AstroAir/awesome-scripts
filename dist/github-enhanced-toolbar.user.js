// ==UserScript==
// @name        GitHub 增强工具栏
// @description 在 Github 网站顶部显示 Github.dev、DeepWiki 和 ZreadAi 按钮，完美支持亮暗色主题自动适配
// @version     2.1.1
// @author      Txy-Sky
// @match       https://github.com/*
// @grant       none
// @icon        https://github.com/favicons/favicon.svg
// @license     MIT
// @namespace   https://github.com/txy-sky
// @run-at      document-end
// ==/UserScript==

(()=>{"use strict";const t=3,n=1200,o=300,e=100,a=500,i=[{id:"githubdevButton",baseUrl:"https://github.dev",text:"Github.dev",iconType:"image",iconSrc:"https://github.com/favicons/favicon-codespaces.svg"},{id:"zreadaiButton",baseUrl:"https://zread.ai",text:"ZreadAi",iconType:"svg",iconContent:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="16" height="16" fill="currentColor">\n      <path d="M9.91922 3.2002H4.47922C3.77229 3.2002 3.19922 3.77327 3.19922 4.4802V9.9202C3.19922 10.6271 3.77229 11.2002 4.47922 11.2002H9.91922C10.6261 11.2002 11.1992 10.6271 11.1992 9.9202V4.4802C11.1992 3.77327 10.6261 3.2002 9.91922 3.2002Z"></path>\n      <path d="M9.91922 20.7998H4.47922C3.77229 20.7998 3.19922 21.3729 3.19922 22.0798V27.5198C3.19922 28.2267 3.77229 28.7998 4.47922 28.7998H9.91922C10.6261 28.7998 11.1992 28.2267 11.1992 27.5198V22.0798C11.1992 21.3729 10.6261 20.7998 9.91922 20.7998Z"></path>\n      <path d="M27.5208 3.2002H22.0808C21.3739 3.2002 20.8008 3.77327 20.8008 4.4802V9.9202C20.8008 10.6271 21.3739 11.2002 22.0808 11.2002H27.5208C28.2277 11.2002 28.8008 10.6271 28.8008 9.9202V4.4802C28.8008 3.77327 28.2277 3.2002 27.5208 3.2002Z"></path>\n      <path d="M8 24L24 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>\n    </svg>'},{id:"deepwikiButton",baseUrl:"https://deepwiki.com",text:"DeepWiki",iconType:"svg",iconContent:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="110 110 460 500" width="16" height="16" fill="currentColor">\n      <path d="M418.73,332.37c9.84-5.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95,15.95-27.63Z" fill="#21c19a"></path>\n      <path d="M141.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z" fill="#3969ca"></path>\n      <path d="M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22Z" fill="#0294de"></path>\n    </svg>'}],r=["ul.pagehead-actions",".pagehead-actions",".file-navigation .d-flex",'nav[aria-label="Repository"] .d-flex'];function c(){return document.documentElement.getAttribute("data-color-mode")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}function d(t,n=!1){const{id:o,baseUrl:e,text:a,iconType:i,iconSrc:r,iconContent:c}=t,d=document.createElement("li");d.id=o,d.className="d-flex";const u=document.createElement("a");let s;if(u.href=function(t){try{const n=new URL(t);return n.pathname=location.pathname,n.search=location.search,n.hash=location.hash,n.href}catch(n){return console.error("[GitHub增强] 构建 URL 失败:",n),t}}(e),u.className=n?"btn btn-sm custom-github-button icon-only":"btn btn-sm custom-github-button",u.target="_blank",u.rel="noopener noreferrer",u.setAttribute("aria-label",a),n&&(u.title=a),"image"===i?s=function(t){const n=document.createElement("img");return n.className="octicon",n.width=16,n.height=16,n.src=t,n.alt="",n.loading="lazy",n}(r):"svg"===i&&(s=function(t){const n=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;return n.classList.add("octicon"),n.hasAttribute("width")||n.setAttribute("width","16"),n.hasAttribute("height")||n.setAttribute("height","16"),n.hasAttribute("fill")||n.setAttribute("fill","currentColor"),n}(c)),s&&u.appendChild(s),!n){const t=document.createElement("span");t.textContent=a,u.appendChild(t)}return d.appendChild(u),d}async function u(){try{const o=await async function(){for(const t of r){const n=document.querySelector(t);if(n)return n}return null}();if(!o)return void console.log("[GitHub增强] 未找到按钮容器");i.forEach(({id:t})=>{const n=document.getElementById(t);n&&n.remove()});const e=function(t){if(!t)return 0;const n=i.map(t=>`#${t.id}`).join(",");return t.querySelectorAll(`li:not(${n})`).length}(o),a=window.innerWidth<n,u=e>t||a;i.slice().reverse().forEach(t=>{const n=d(t,u);o.insertBefore(n,o.firstChild)});const s=c();console.log(`[GitHub增强] 成功添加 ${i.length} 个按钮 (${u?"图标":"文本"}模式, ${s}主题)`)}catch(t){console.error("[GitHub增强] 添加按钮失败:",t)}}!function(){!function(){const t=document.createElement("style");t.textContent='\n    /* 自定义按钮基础样式 - 与 GitHub 原生按钮保持一致 */\n    .custom-github-button {\n      margin: 0 4px;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      height: 28px;\n      padding: 5px 16px;\n      border-radius: 6px;\n      font-weight: 500;\n      font-size: 14px;\n      line-height: 20px;\n      transition: all 0.2s cubic-bezier(0.3, 0, 0.5, 1);\n      text-decoration: none;\n      white-space: nowrap;\n      cursor: pointer;\n      position: relative;\n      vertical-align: middle;\n    }\n\n    /* 亮色主题样式 */\n    [data-color-mode="light"] .custom-github-button,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button {\n      background: #f6f8fa;\n      color: #24292f;\n      border: 1px solid rgba(27, 31, 36, 0.15);\n      box-shadow: 0 1px 0 rgba(27, 31, 36, 0.04);\n    }\n\n    [data-color-mode="light"] .custom-github-button:hover,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button:hover {\n      background: #f3f4f6;\n      border-color: rgba(27, 31, 36, 0.15);\n      box-shadow: 0 3px 8px rgba(27, 31, 36, 0.12);\n    }\n\n    /* 暗色主题样式 */\n    [data-color-mode="dark"] .custom-github-button,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button {\n      background: #21262d;\n      color: #c9d1d9;\n      border: 1px solid rgba(240, 246, 252, 0.1);\n      box-shadow: 0 0 transparent;\n    }\n\n    [data-color-mode="dark"] .custom-github-button:hover,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button:hover {\n      background: #30363d;\n      border-color: rgba(240, 246, 252, 0.2);\n      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);\n    }\n\n    /* 按钮激活状态 */\n    .custom-github-button:active {\n      transform: translateY(0);\n      transition: none;\n    }\n\n    [data-color-mode="light"] .custom-github-button:active,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button:active {\n      background: #ebeff3;\n      box-shadow: inset 0 1px 2px rgba(27, 31, 36, 0.1);\n    }\n\n    [data-color-mode="dark"] .custom-github-button:active,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button:active {\n      background: #282e36;\n      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);\n    }\n\n    /* 焦点状态 - 亮色主题 */\n    [data-color-mode="light"] .custom-github-button:focus-visible,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button:focus-visible {\n      outline: 2px solid #0969da;\n      outline-offset: 2px;\n    }\n\n    /* 焦点状态 - 暗色主题 */\n    [data-color-mode="dark"] .custom-github-button:focus-visible,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button:focus-visible {\n      outline: 2px solid #58a6ff;\n      outline-offset: 2px;\n    }\n\n    /* 图标样式 - 亮色主题 */\n    [data-color-mode="light"] .custom-github-button .octicon,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button .octicon {\n      margin-right: 6px;\n      flex-shrink: 0;\n      transition: transform 0.2s ease;\n      width: 16px;\n      height: 16px;\n      display: inline-block;\n      vertical-align: text-bottom;\n      color: #57606a;\n      fill: currentColor;\n    }\n\n    /* 图标样式 - 暗色主题（增强对比度） */\n    [data-color-mode="dark"] .custom-github-button .octicon,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button .octicon {\n      margin-right: 6px;\n      flex-shrink: 0;\n      transition: transform 0.2s ease;\n      width: 16px;\n      height: 16px;\n      display: inline-block;\n      vertical-align: text-bottom;\n      color: #8b949e;\n      fill: currentColor;\n      filter: brightness(1.2);\n    }\n\n    /* 图标 hover 状态 - 亮色主题 */\n    [data-color-mode="light"] .custom-github-button:hover .octicon,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button:hover .octicon {\n      transform: scale(1.1) rotate(5deg);\n      color: #24292f;\n    }\n\n    /* 图标 hover 状态 - 暗色主题 */\n    [data-color-mode="dark"] .custom-github-button:hover .octicon,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button:hover .octicon {\n      transform: scale(1.1) rotate(5deg);\n      color: #c9d1d9;\n      filter: brightness(1.4);\n    }\n\n    /* 图片图标额外样式 - 暗色主题优化 */\n    [data-color-mode="dark"] .custom-github-button img.octicon,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button img.octicon {\n      opacity: 0.85;\n    }\n\n    [data-color-mode="dark"] .custom-github-button:hover img.octicon,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button:hover img.octicon {\n      opacity: 1;\n      filter: brightness(1.1);\n    }\n\n    /* 仅图标模式 */\n    .custom-github-button.icon-only {\n      padding: 5px 12px;\n      min-width: 28px;\n    }\n\n    .custom-github-button.icon-only .octicon {\n      margin-right: 0;\n    }\n\n    /* 文本样式 */\n    .custom-github-button span {\n      font-size: 14px;\n      line-height: 20px;\n      font-weight: 500;\n    }\n\n    /* 容器样式优化 */\n    .pagehead-actions > li {\n      margin-right: 0 !important;\n      display: flex;\n      align-items: center;\n    }\n\n    /* Tooltip 样式 - 亮色主题 */\n    [data-color-mode="light"] .custom-github-button[title]:hover::after,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button[title]:hover::after {\n      content: attr(title);\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      margin-bottom: 8px;\n      padding: 6px 12px;\n      background: #24292f;\n      color: #ffffff;\n      border-radius: 6px;\n      font-size: 12px;\n      font-weight: 400;\n      white-space: nowrap;\n      z-index: 1000;\n      pointer-events: none;\n      opacity: 0;\n      animation: tooltipFadeIn 0.2s ease 0.3s forwards;\n    }\n\n    [data-color-mode="light"] .custom-github-button[title]:hover::before,\n    [data-color-mode="auto"][data-light-theme] .custom-github-button[title]:hover::before {\n      content: \'\';\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      margin-bottom: 2px;\n      border: 6px solid transparent;\n      border-top-color: #24292f;\n      z-index: 1000;\n      pointer-events: none;\n      opacity: 0;\n      animation: tooltipFadeIn 0.2s ease 0.3s forwards;\n    }\n\n    /* Tooltip 样式 - 暗色主题 */\n    [data-color-mode="dark"] .custom-github-button[title]:hover::after,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button[title]:hover::after {\n      content: attr(title);\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      margin-bottom: 8px;\n      padding: 6px 12px;\n      background: #f0f6fc;\n      color: #0d1117;\n      border-radius: 6px;\n      font-size: 12px;\n      font-weight: 400;\n      white-space: nowrap;\n      z-index: 1000;\n      pointer-events: none;\n      opacity: 0;\n      animation: tooltipFadeIn 0.2s ease 0.3s forwards;\n    }\n\n    [data-color-mode="dark"] .custom-github-button[title]:hover::before,\n    [data-color-mode="auto"][data-dark-theme] .custom-github-button[title]:hover::before {\n      content: \'\';\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      margin-bottom: 2px;\n      border: 6px solid transparent;\n      border-top-color: #f0f6fc;\n      z-index: 1000;\n      pointer-events: none;\n      opacity: 0;\n      animation: tooltipFadeIn 0.2s ease 0.3s forwards;\n    }\n\n    @keyframes tooltipFadeIn {\n      from {\n        opacity: 0;\n        transform: translateX(-50%) translateY(-4px);\n      }\n      to {\n        opacity: 1;\n        transform: translateX(-50%) translateY(0);\n      }\n    }\n\n    /* 响应式设计 */\n    @media (max-width: 768px) {\n      .custom-github-button {\n        padding: 3px 12px;\n        margin: 0 2px;\n        height: 28px;\n      }\n\n      .custom-github-button span {\n        font-size: 13px;\n      }\n\n      .custom-github-button .octicon {\n        width: 14px;\n        height: 14px;\n      }\n\n      .custom-github-button.icon-only {\n        padding: 3px 10px;\n      }\n    }\n\n    /* 打印样式 */\n    @media print {\n      .custom-github-button {\n        display: none !important;\n      }\n    }\n\n    /* 高对比度模式支持 */\n    @media (prefers-contrast: high) {\n      .custom-github-button {\n        border-width: 2px;\n      }\n\n      [data-color-mode="dark"] .custom-github-button .octicon,\n      [data-color-mode="auto"][data-dark-theme] .custom-github-button .octicon {\n        filter: brightness(1.5);\n      }\n    }\n\n    /* 减少动画模式 */\n    @media (prefers-reduced-motion: reduce) {\n      .custom-github-button,\n      .custom-github-button .octicon {\n        transition: none !important;\n        animation: none !important;\n      }\n\n      .custom-github-button:hover .octicon {\n        transform: none;\n      }\n    }\n  ',t.setAttribute("data-github-enhancer","true"),document.head.appendChild(t)}(),function(){const t=document.documentElement,n=new MutationObserver(t=>{t.forEach(t=>{if("attributes"===t.type&&("data-color-mode"===t.attributeName||"data-light-theme"===t.attributeName||"data-dark-theme"===t.attributeName)){const t=c();console.log(`[GitHub增强] 主题已切换至: ${t}`)}})});n.observe(t,{attributes:!0,attributeFilter:["data-color-mode","data-light-theme","data-dark-theme"]})}();const t=function(t,n){let o;return function(...e){clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),t(...e)},n)}}(u,o);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):setTimeout(t,e),document.addEventListener("pjax:end",t),document.addEventListener("turbo:load",t),window.addEventListener("resize",t),function(t){let n=location.href;const o=new MutationObserver(()=>{location.href!==n&&(n=location.href,t())});o.observe(document.body,{childList:!0,subtree:!0})}(()=>{setTimeout(t,a)}),console.log(`[GitHub增强] 脚本已初始化 (当前主题: ${c()})`)}()})();