// ==UserScript==
// @name        Linux.do Ëá™Âä®Ê†áËÆ∞Â∑≤ËØª Ultimate
// @description Ëá™Âä®Â∞Ü Linux.do ËÆ∫ÂùõÁöÑÂ∏ñÂ≠êÂèäÂõûÂ§çÊ†áËÆ∞‰∏∫Â∑≤ËØª - ÁúüÂÆûË°å‰∏∫Ê®°ÊãüÁâà
// @version     4.0
// @author      by.‰∏âÊñáÈ±º (UltimateÁâà)
// @match       https://linux.do/*
// @grant       GM_addStyle
// @grant       GM_setValue
// @grant       GM_getValue
// @grant       GM_notification
// @license     MIT
// @namespace   http://tampermonkey.net/
// @run-at      document-end
// ==/UserScript==

(()=>{"use strict";const n="linux_do_auto_reader_ultimate",a=150,t=25,e=5e3,r=6e4,i={theme:"dark",minimized:!1,position:{x:null,y:null},sound:!1,notifications:!0,autoStart:!1,mode:"human",concurrency:1,intervals:{betweenTopics:{min:8e3,max:25e3},betweenReplies:{min:1500,max:5e3},betweenBatches:{min:3e4,max:9e4},pageStay:{min:5e3,max:2e4},scrollPause:{min:500,max:2e3}},reading:{maxRepliesPerTopic:50,maxTopicsPerBatch:10,scrollSimulation:!0,randomOrder:!0,skipLongTopics:!1,longTopicThreshold:100},behavior:{randomSkip:!0,skipProbability:.1,readingSpeedVariation:.3,occasionalPause:!0,pauseProbability:.05,pauseDuration:{min:3e4,max:12e4},activeHours:{enabled:!1,start:8,end:23}},safety:{maxDailyTopics:200,maxDailyReplies:2e3,cooldownAfterError:6e4,maxConsecutiveErrors:5}},s={turbo:{name:"‚ö° ÊûÅÈÄüÊ®°Âºè",desc:"ÊúÄÂø´ÈÄüÂ∫¶Ôºå‰ªÖÊ†áËÆ∞‰∏ªÂ∏ñ",icon:"‚ö°",settings:{concurrency:3,intervals:{betweenTopics:{min:2e3,max:5e3},betweenReplies:{min:500,max:1e3},betweenBatches:{min:1e4,max:2e4},pageStay:{min:1e3,max:3e3},scrollPause:{min:200,max:500}},reading:{maxRepliesPerTopic:0,maxTopicsPerBatch:20,scrollSimulation:!1,randomOrder:!1},behavior:{randomSkip:!1,occasionalPause:!1}}},fast:{name:"üöÄ Âø´ÈÄüÊ®°Âºè",desc:"ËæÉÂø´ÈÄüÂ∫¶ÔºåÊ†áËÆ∞ÈÉ®ÂàÜÂõûÂ§ç",icon:"üöÄ",settings:{concurrency:2,intervals:{betweenTopics:{min:4e3,max:1e4},betweenReplies:{min:800,max:2e3},betweenBatches:{min:2e4,max:4e4},pageStay:{min:2e3,max:5e3},scrollPause:{min:300,max:800}},reading:{maxRepliesPerTopic:20,maxTopicsPerBatch:15,scrollSimulation:!0,randomOrder:!1},behavior:{randomSkip:!1,occasionalPause:!1}}},normal:{name:"üìñ Ê†áÂáÜÊ®°Âºè",desc:"Âπ≥Ë°°ÈÄüÂ∫¶‰∏éÂÆâÂÖ®",icon:"üìñ",settings:{concurrency:1,intervals:{betweenTopics:{min:8e3,max:2e4},betweenReplies:{min:1500,max:4e3},betweenBatches:{min:45e3,max:9e4},pageStay:{min:5e3,max:15e3},scrollPause:{min:500,max:1500}},reading:{maxRepliesPerTopic:50,maxTopicsPerBatch:10,scrollSimulation:!0,randomOrder:!0},behavior:{randomSkip:!0,skipProbability:.1,occasionalPause:!0,pauseProbability:.05}}},human:{name:"üßë ‰ªøÁúüÊ®°Âºè",desc:"Ê®°ÊãüÁúüÂÆûÁî®Êà∑Ë°å‰∏∫",icon:"üßë",settings:{concurrency:1,intervals:{betweenTopics:{min:15e3,max:45e3},betweenReplies:{min:2e3,max:6e3},betweenBatches:{min:6e4,max:18e4},pageStay:{min:8e3,max:3e4},scrollPause:{min:800,max:3e3}},reading:{maxRepliesPerTopic:30,maxTopicsPerBatch:8,scrollSimulation:!0,randomOrder:!0},behavior:{randomSkip:!0,skipProbability:.15,occasionalPause:!0,pauseProbability:.1,pauseDuration:{min:6e4,max:18e4}}}},stealth:{name:"ü•∑ ÈöêË∫´Ê®°Âºè",desc:"ÊúÄÂ§ßÁ®ãÂ∫¶Ê®°ÊãüÁúü‰∫∫",icon:"ü•∑",settings:{concurrency:1,intervals:{betweenTopics:{min:3e4,max:9e4},betweenReplies:{min:3e3,max:1e4},betweenBatches:{min:12e4,max:3e5},pageStay:{min:15e3,max:6e4},scrollPause:{min:1e3,max:5e3}},reading:{maxRepliesPerTopic:20,maxTopicsPerBatch:5,scrollSimulation:!0,randomOrder:!0},behavior:{randomSkip:!0,skipProbability:.2,occasionalPause:!0,pauseProbability:.15,pauseDuration:{min:12e4,max:3e5},activeHours:{enabled:!0,start:9,end:22}}}},custom:{name:"‚öôÔ∏è Ëá™ÂÆö‰πâ",desc:"ÂÆåÂÖ®Ëá™ÂÆö‰πâÂèÇÊï∞",icon:"‚öôÔ∏è",settings:null}},o={isRunning:!1,isPaused:!1,lastCheckTime:0,csrfToken:null,currentTopic:null,runtime:{startTime:null,pausedTime:0,lastPauseStart:null},stats:{session:{topicsMarked:0,repliesMarked:0,topicsSkipped:0,errors:0,startTime:null},daily:{topicsMarked:0,repliesMarked:0,date:null},total:{topicsMarked:0,repliesMarked:0}},queue:{topics:[],currentIndex:0,processing:!1},errors:{consecutive:0,lastError:null},settings:JSON.parse(JSON.stringify(i))},d={random:(n,a)=>Math.floor(Math.random()*(a-n+1))+n,randomFloat:(n,a)=>Math.random()*(a-n)+n,randomDelay(n){const a=this.random(n.min,n.max),t=.1*a;return a+this.random(-t,t)},gaussianRandom(n,a){let t=0,e=0;for(;0===t;)t=Math.random();for(;0===e;)e=Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e)*a+n},sleep:n=>new Promise(a=>setTimeout(a,n)),sleepWithCancel(n){let a;const t=new Promise(t=>{a=setTimeout(t,n)});return t.cancel=()=>clearTimeout(a),t},truncate:(n,a)=>n?n.length>a?n.substring(0,a)+"...":n:"",formatDuration(n){const a=Math.floor(n/1e3),t=Math.floor(a/3600),e=Math.floor(a%3600/60),r=a%60;return t>0?`${t}:${e.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`:`${e}:${r.toString().padStart(2,"0")}`},formatNumber:n=>n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString(),isActiveHours(n){if(!n.behavior.activeHours.enabled)return!0;const a=(new Date).getHours(),{start:t,end:e}=n.behavior.activeHours;return t<=e?a>=t&&a<e:a>=t||a<e},checkDailyLimits(n,a){const t=(new Date).toDateString();return a.daily.date!==t&&(a.daily={topicsMarked:0,repliesMarked:0,date:t}),{topicsOk:a.daily.topicsMarked<n.safety.maxDailyTopics,repliesOk:a.daily.repliesMarked<n.safety.maxDailyReplies,topicsRemaining:n.safety.maxDailyTopics-a.daily.topicsMarked,repliesRemaining:n.safety.maxDailyReplies-a.daily.repliesMarked}},deepMerge(n,a){const t={...n};for(const e in a)a[e]instanceof Object&&e in n?t[e]=this.deepMerge(n[e],a[e]):t[e]=a[e];return t},shuffle(n){const a=[...n];for(let n=a.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[a[n],a[t]]=[a[t],a[n]]}return a}},c={save(){const a={isRunning:o.isRunning,lastCheckTime:Date.now(),stats:o.stats,settings:o.settings};try{localStorage.setItem(n,JSON.stringify(a))}catch(n){console.error("‰øùÂ≠òÁä∂ÊÄÅÂ§±Ë¥•:",n)}},load(){try{const a=localStorage.getItem(n);if(a){const n=JSON.parse(a);o.isRunning=n.isRunning||!1,o.lastCheckTime=n.lastCheckTime||0,o.stats=d.deepMerge(o.stats,n.stats||{}),o.settings=d.deepMerge(i,n.settings||{})}}catch(n){console.error("Âä†ËΩΩÁä∂ÊÄÅÂ§±Ë¥•:",n)}},clear(a,t){localStorage.removeItem(n),o.stats={session:{topicsMarked:0,repliesMarked:0,topicsSkipped:0,errors:0,startTime:null},daily:{topicsMarked:0,repliesMarked:0,date:null},total:{topicsMarked:0,repliesMarked:0}},a&&a.updateStats(),t&&t.info("üìä ÁªüËÆ°Êï∞ÊçÆÂ∑≤ÈáçÁΩÆ")},exportSettings:()=>JSON.stringify(o.settings,null,2),importSettings(n){try{const a=JSON.parse(n);return o.settings=d.deepMerge(i,a),this.save(),!0}catch(n){return!1}}},l=c,p={logs:[],uiRef:null,setUI(n){this.uiRef=n},add(n,t){const e=(new Date).toLocaleTimeString("zh-CN",{hour12:!1}),r={time:e,message:n,type:t};this.logs.push(r),this.logs.length>a&&this.logs.shift(),this.uiRef&&this.uiRef.appendLog(r),console.log(`[${t.toUpperCase()}] ${e} ${n}`)},info(n){this.add(n,"info")},success(n){this.add(n,"success")},warn(n){this.add(n,"warning")},error(n){this.add(n,"error")},clear(){this.logs=[];const n=document.getElementById("ar-logs");n&&(n.innerHTML='\n        <div class="ar-empty">\n          <div class="ar-empty-icon">üì≠</div>\n          <div class="ar-empty-text">ÊöÇÊó†Êó•Âøó</div>\n        </div>\n      ')}},g=p,u={requestCount:0,lastRequestTime:0,async getCSRFToken(){if(!o.csrfToken){const n=document.querySelector("meta[name=csrf-token]");if(!n)throw new Error("Êó†Ê≥ïËé∑Âèñ CSRF Token");o.csrfToken=n.content}return o.csrfToken},async request(n,a={}){const t=Date.now()-this.lastRequestTime;t<500&&await d.sleep(500-t),this.lastRequestTime=Date.now(),this.requestCount++;const e=await fetch(n,{credentials:"include",...a});if(!e.ok)throw new Error(`HTTP ${e.status}`);return e},async getTopics(n=0){return(await this.request(`https://linux.do/latest.json?no_definitions=true&page=${n}`)).json()},async getTopicDetails(n){return(await this.request(`https://linux.do/t/${n}.json`)).json()},async getMorePosts(n,a){const t=a.map(n=>`post_ids[]=${n}`).join("&");return(await this.request(`https://linux.do/t/${n}/posts.json?${t}`)).json()},async markAsRead(n,a,t){const e=await this.getCSRFToken();let r=`topic_time=${t}&topic_id=${n}`;return Array.isArray(a)?a.forEach(n=>{const a=Math.floor(t*d.randomFloat(.8,1.2));r+=`&timings%5B${n}%5D=${a}`}):r+=`&timings%5B${a}%5D=${t}`,await this.request("https://linux.do/topics/timings",{method:"POST",headers:{accept:"*/*","content-type":"application/x-www-form-urlencoded; charset=UTF-8","x-csrf-token":e,"x-requested-with":"XMLHttpRequest"},body:r}),!0},async updateReadProgress(n,a,t){const e=await this.getCSRFToken();return await this.request(`https://linux.do/topics/topic/${n}/read.json`,{method:"POST",headers:{accept:"*/*","content-type":"application/x-www-form-urlencoded; charset=UTF-8","x-csrf-token":e,"x-requested-with":"XMLHttpRequest"},body:`last_read_post_number=${a}&highest_post_number=${t}`}),!0}},m={uiRef:null,setUI(n){this.uiRef=n},async simulateReading(n,a){const{intervals:t,reading:e,behavior:r}=a;if(r.randomSkip&&Math.random()<r.skipProbability)return g.info(`‚è≠Ô∏è ÈöèÊú∫Ë∑≥Ëøá: ${d.truncate(n.title,30)}`),o.stats.session.topicsSkipped++,{skipped:!0};if(e.skipLongTopics&&n.posts_count>e.longTopicThreshold)return g.info(`‚è≠Ô∏è Ë∑≥ËøáÈïøÂ∏ñ(${n.posts_count}ÂõûÂ§ç): ${d.truncate(n.title,25)}`),o.stats.session.topicsSkipped++,{skipped:!0};g.info(`üìñ ÈòÖËØª: ${d.truncate(n.title,35)}`),o.currentTopic=n,this.uiRef&&this.uiRef.updateProgress(0,"ÈòÖËØª‰∏≠...");try{const a=await u.getTopicDetails(n.id),r=a.post_stream?.posts||[],i=a.post_stream?.stream||[],s=e.maxRepliesPerTopic;if(0===s)return await this.markWithDelay(n.id,[1],t),{topicsMarked:1,repliesMarked:1};const c=d.randomDelay(t.pageStay);g.info(`   ‚îî‚îÄ ÂÅúÁïô ${(c/1e3).toFixed(1)}s`),await d.sleep(c);let l=r.map(n=>n.post_number);if(i.length>r.length&&l.length<s){const a=new Set(r.map(n=>n.id)),c=i.filter(n=>!a.has(n)).slice(0,s-l.length);if(c.length>0){g.info(`   ‚îî‚îÄ Âä†ËΩΩÊõ¥Â§öÂõûÂ§ç (${c.length}‰∏™)`);const a=20;for(let r=0;r<c.length&&o.isRunning&&!o.isPaused;r+=a){const i=c.slice(r,r+a);try{const a=await u.getMorePosts(n.id,i),r=a.post_stream?.posts?.map(n=>n.post_number)||[];l.push(...r),e.scrollSimulation&&await d.sleep(d.randomDelay(t.scrollPause))}catch(n){g.warn(`   ‚îî‚îÄ Âä†ËΩΩÂõûÂ§çÂ§±Ë¥•: ${n.message}`)}}}}l=l.slice(0,s);let p=0;const m=5;for(let a=0;a<l.length&&o.isRunning&&!o.isPaused;a+=m){const e=l.slice(a,a+m),r=(a+e.length)/l.length*100;this.uiRef&&this.uiRef.updateProgress(r,`ÈòÖËØªÂõûÂ§ç ${a+1}-${a+e.length}/${l.length}`);const i=d.random(t.betweenReplies.min*e.length*.3,t.betweenReplies.max*e.length*.5);if(await u.markAsRead(n.id,e,i),p+=e.length,a+m<l.length){const n=d.randomDelay(t.betweenReplies);await d.sleep(n)}}if(l.length>0){const a=Math.max(...l);await u.updateReadProgress(n.id,a,n.highest_post_number||a)}return g.success(`   ‚îî‚îÄ ‚úì Â∑≤ËØª ${p} ‰∏™ÂõûÂ§ç`),{topicsMarked:1,repliesMarked:p}}catch(n){throw g.error(`   ‚îî‚îÄ ‚úó Â§±Ë¥•: ${n.message}`),n}},async markWithDelay(n,a,t){const e=d.random(1e3,3e3);await u.markAsRead(n,a,e)},async checkForPause(n){const{behavior:a}=n;if(a.occasionalPause&&Math.random()<a.pauseProbability){const n=d.randomDelay(a.pauseDuration);return g.info(`‚òï ÈöèÊú∫‰ºëÊÅØ ${d.formatDuration(n)}`),this.uiRef&&this.uiRef.updateProgress(0,"‰ºëÊÅØ‰∏≠..."),await d.sleep(n),!0}return!1}},b=m,v={checkTimer:null,heartbeatTimer:null,currentSleepPromise:null,uiRef:null,setUI(n){this.uiRef=n,b.setUI(n)},getEffectiveSettings(){const n=o.settings.mode;if("custom"===n||!s[n])return o.settings;const a=s[n];return d.deepMerge(o.settings,a.settings||{})},async doCheck(){if(!o.isRunning||o.isPaused)return;const n=this.getEffectiveSettings();if(!d.isActiveHours(n))return g.info("üí§ ÂΩìÂâç‰∏çÂú®Ê¥ªË∑ÉÊó∂Èó¥ÊÆµÔºåÁ≠âÂæÖ‰∏≠..."),void this.scheduleNextCheck(n.intervals.betweenBatches);const a=d.checkDailyLimits(n,o.stats);if(!a.topicsOk)return g.warn(`‚ö†Ô∏è Â∑≤ËææÂà∞ÊØèÊó•Â∏ñÂ≠ê‰∏äÈôê (${n.safety.maxDailyTopics})`),void this.stop();this.uiRef&&this.uiRef.updateProgress(0,"Ëé∑ÂèñÂ∏ñÂ≠êÂàóË°®...");try{const t=await u.getTopics(),e=t.topic_list?.topics||[];let r=e.filter(n=>n.unseen);if(this.uiRef&&this.uiRef.updateTopicsList(e),0===r.length)g.info(`‚úì Êó†Êú™ËØªÂ∏ñÂ≠ê (ÂÖ± ${e.length} ‰∏™)`),this.uiRef&&this.uiRef.updateProgress(100,"Á≠âÂæÖ‰∏ãÊ¨°Ê£ÄÊü•...");else{const t=Math.min(n.reading.maxTopicsPerBatch,a.topicsRemaining);r=r.slice(0,t),n.reading.randomOrder&&(r=d.shuffle(r)),g.success(`üì¨ ÂèëÁé∞ ${r.length} ‰∏™Êú™ËØªÂ∏ñÂ≠ê`),o.settings.sound&&this.playSound(),o.settings.notifications&&this.showNotification(`ÂèëÁé∞ ${r.length} ‰∏™Êú™ËØªÂ∏ñÂ≠ê`),await this.processTopics(r,n)}o.errors.consecutive=0}catch(a){if(g.error(`Ê£ÄÊü•Â§±Ë¥•: ${a.message}`),o.stats.session.errors++,o.errors.consecutive++,o.errors.lastError=a.message,o.errors.consecutive>=n.safety.maxConsecutiveErrors)return g.error("ËøûÁª≠ÈîôËØØËøáÂ§öÔºåÊöÇÂÅúËøêË°å"),void this.pause();g.info(`Á≠âÂæÖ ${n.safety.cooldownAfterError/1e3}s ÂêéÈáçËØï...`),await d.sleep(n.safety.cooldownAfterError)}o.lastCheckTime=Date.now(),l.save(),o.isRunning&&!o.isPaused&&this.scheduleNextCheck(n.intervals.betweenBatches)},async processTopics(n,a){const{concurrency:t}=a;t>1?await this.processTopicsConcurrent(n,a,t):await this.processTopicsSequential(n,a)},async processTopicsSequential(n,a){for(let t=0;t<n.length&&o.isRunning&&!o.isPaused;t++){const e=n[t],r=(t+1)/n.length*100;this.uiRef&&(this.uiRef.updateProgress(r,`Â§ÑÁêÜ ${t+1}/${n.length}`),this.uiRef.highlightCurrentTopic(e.id));try{const n=await b.simulateReading(e,a);n.skipped||(o.stats.session.topicsMarked++,o.stats.daily.topicsMarked++,o.stats.total.topicsMarked++,n.repliesMarked&&(o.stats.session.repliesMarked+=n.repliesMarked,o.stats.daily.repliesMarked+=n.repliesMarked,o.stats.total.repliesMarked+=n.repliesMarked),this.uiRef&&this.uiRef.updateStats())}catch(n){o.stats.session.errors++,o.errors.consecutive++}if(t<n.length-1&&o.isRunning&&!o.isPaused){await b.checkForPause(a);const n=d.randomDelay(a.intervals.betweenTopics);g.info(`‚è≥ Á≠âÂæÖ ${(n/1e3).toFixed(1)}s`),await d.sleep(n)}}o.currentTopic=null,this.uiRef&&this.uiRef.updateProgress(100,"ÊâπÊ¨°ÂÆåÊàê"),g.success("‚úÖ Êú¨ËΩÆÂÆåÊàê")},async processTopicsConcurrent(n,a,t){const e=[...n],r=[];let i=0;const s=async r=>{for(;e.length>0&&o.isRunning&&!o.isPaused;){const r=e.shift();if(!r)break;try{const n=await b.simulateReading(r,a);n.skipped||(o.stats.session.topicsMarked++,o.stats.daily.topicsMarked++,o.stats.total.topicsMarked++,n.repliesMarked&&(o.stats.session.repliesMarked+=n.repliesMarked,o.stats.daily.repliesMarked+=n.repliesMarked,o.stats.total.repliesMarked+=n.repliesMarked))}catch(n){o.stats.session.errors++}i++;const s=i/n.length*100;if(this.uiRef&&(this.uiRef.updateProgress(s,`Â§ÑÁêÜ ${i}/${n.length}`),this.uiRef.updateStats()),e.length>0){const n=d.randomDelay(a.intervals.betweenTopics);await d.sleep(n/t)}}};for(let n=0;n<t;n++)r.push(s());await Promise.all(r),o.currentTopic=null,this.uiRef&&this.uiRef.updateProgress(100,"ÊâπÊ¨°ÂÆåÊàê"),g.success(`‚úÖ Êú¨ËΩÆÂÆåÊàê (${t}Âπ∂Âèë)`)},scheduleNextCheck(n){const a=d.randomDelay(n);g.info(`‚è∞ ${d.formatDuration(a)} Âêé‰∏ãÊ¨°Ê£ÄÊü•`),this.checkTimer=setTimeout(()=>this.doCheck(),a)},start(){if(o.isRunning)return;o.isRunning=!0,o.isPaused=!1,o.runtime.startTime=Date.now(),o.stats.session={topicsMarked:0,repliesMarked:0,topicsSkipped:0,errors:0,startTime:Date.now()},o.errors.consecutive=0,l.save(),this.uiRef&&this.uiRef.updateStatus();const n=s[o.settings.mode];g.success(`üöÄ ÂºÄÂßãËøêË°å [${n?.name||"Ëá™ÂÆö‰πâ"}]`),this.doCheck(),this.startHeartbeat()},stop(){o.isRunning=!1,o.isPaused=!1,o.currentTopic=null,clearTimeout(this.checkTimer),clearTimeout(this.heartbeatTimer),l.save(),this.uiRef&&(this.uiRef.updateStatus(),this.uiRef.updateProgress(0,"Â∑≤ÂÅúÊ≠¢")),g.info("‚èπ Â∑≤ÂÅúÊ≠¢")},pause(){o.isPaused=!o.isPaused,o.isPaused?(o.runtime.lastPauseStart=Date.now(),clearTimeout(this.checkTimer),g.info("‚è∏ Â∑≤ÊöÇÂÅú")):(o.runtime.lastPauseStart&&(o.runtime.pausedTime+=Date.now()-o.runtime.lastPauseStart),g.info("‚ñ∂ Â∑≤ÊÅ¢Â§ç"),o.isRunning&&this.doCheck()),this.uiRef&&this.uiRef.updateStatus()},startHeartbeat(){const n=()=>{o.isRunning&&(Date.now()-o.lastCheckTime>r&&!o.isPaused&&(g.warn("üíì ÂøÉË∑≥Ëß¶Âèë"),this.doCheck()),this.heartbeatTimer=setTimeout(n,e))};n()},checkNow(){o.isRunning?o.isPaused||(clearTimeout(this.checkTimer),this.doCheck()):this.start()},playSound(){try{const n=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp6jn5yklomCgX19hIuVnJ+dmpeQiYOBgYSHi4+Slo+LhoOBgA==");n.volume=.3,n.play().catch(()=>{})}catch(n){}},showNotification(n){"function"==typeof GM_notification&&GM_notification({title:"Linux.do Ëá™Âä®ÈòÖËØª",text:n,timeout:3e3})}},h=v,x={container:null,isDragging:!1,dragOffset:{x:0,y:0},coreRef:null,setCore(n){this.coreRef=n},init(){this.injectStyles(),this.createPanel(),this.bindEvents(),this.restorePosition(),this.updateStatus(),this.updateStats(),this.updateModeDisplay()},injectStyles(){if("function"==typeof GM_addStyle)GM_addStyle("\n    /* ===== CSS ÂèòÈáè ===== */\n    :root {\n      --ar-bg: rgba(13, 17, 23, 0.98);\n      --ar-bg-secondary: rgba(22, 27, 34, 0.95);\n      --ar-bg-tertiary: rgba(33, 38, 45, 0.9);\n      --ar-bg-hover: rgba(48, 54, 61, 0.8);\n      --ar-border: rgba(48, 54, 61, 0.6);\n      --ar-border-light: rgba(48, 54, 61, 0.3);\n      --ar-text: #e6edf3;\n      --ar-text-secondary: #8b949e;\n      --ar-text-muted: #6e7681;\n      --ar-accent: #58a6ff;\n      --ar-accent-dim: rgba(88, 166, 255, 0.15);\n      --ar-success: #3fb950;\n      --ar-success-dim: rgba(63, 185, 80, 0.15);\n      --ar-warning: #d29922;\n      --ar-warning-dim: rgba(210, 153, 34, 0.15);\n      --ar-error: #f85149;\n      --ar-error-dim: rgba(248, 81, 73, 0.15);\n      --ar-purple: #a371f7;\n      --ar-cyan: #39d4d4;\n      --ar-shadow: 0 16px 70px rgba(0, 0, 0, 0.5);\n      --ar-radius: 16px;\n      --ar-radius-md: 12px;\n      --ar-radius-sm: 8px;\n      --ar-radius-xs: 6px;\n      --ar-transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .ar-light {\n      --ar-bg: rgba(255, 255, 255, 0.98);\n      --ar-bg-secondary: rgba(246, 248, 250, 0.95);\n      --ar-bg-tertiary: rgba(234, 238, 242, 0.9);\n      --ar-bg-hover: rgba(208, 215, 222, 0.6);\n      --ar-border: rgba(208, 215, 222, 0.8);\n      --ar-border-light: rgba(208, 215, 222, 0.4);\n      --ar-text: #24292f;\n      --ar-text-secondary: #57606a;\n      --ar-text-muted: #8c959f;\n      --ar-shadow: 0 16px 70px rgba(0, 0, 0, 0.12);\n    }\n\n    /* ===== ‰∏ªÂÆπÂô® ===== */\n    #ar-panel {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 400px;\n      background: var(--ar-bg);\n      color: var(--ar-text);\n      border-radius: var(--ar-radius);\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', sans-serif;\n      font-size: 13px;\n      z-index: 99999;\n      box-shadow: var(--ar-shadow);\n      backdrop-filter: blur(20px);\n      border: 1px solid var(--ar-border);\n      transition: var(--ar-transition);\n      overflow: hidden;\n      max-height: 90vh;\n    }\n\n    #ar-panel.minimized { width: 240px; }\n    #ar-panel.minimized #ar-body { display: none; }\n\n    /* ===== Â§¥ÈÉ® ===== */\n    #ar-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 14px 16px;\n      background: var(--ar-bg-secondary);\n      cursor: move;\n      user-select: none;\n      border-bottom: 1px solid var(--ar-border);\n    }\n\n    #ar-title-section { display: flex; align-items: center; gap: 10px; }\n\n    #ar-status-dot {\n      width: 10px;\n      height: 10px;\n      border-radius: 50%;\n      background: var(--ar-text-muted);\n      transition: var(--ar-transition);\n      flex-shrink: 0;\n    }\n\n    #ar-status-dot.running {\n      background: var(--ar-success);\n      box-shadow: 0 0 0 3px var(--ar-success-dim);\n      animation: statusPulse 2s ease-in-out infinite;\n    }\n\n    #ar-status-dot.paused {\n      background: var(--ar-warning);\n      box-shadow: 0 0 0 3px var(--ar-warning-dim);\n    }\n\n    @keyframes statusPulse {\n      0%, 100% { transform: scale(1); opacity: 1; }\n      50% { transform: scale(1.1); opacity: 0.8; }\n    }\n\n    #ar-title { font-weight: 600; font-size: 14px; }\n\n    #ar-mode-badge {\n      font-size: 11px;\n      padding: 3px 10px;\n      background: var(--ar-accent-dim);\n      color: var(--ar-accent);\n      border-radius: 20px;\n      font-weight: 500;\n      border: 1px solid var(--ar-accent);\n    }\n\n    #ar-header-controls { display: flex; gap: 4px; }\n\n    .ar-icon-btn {\n      background: transparent;\n      border: none;\n      color: var(--ar-text-secondary);\n      cursor: pointer;\n      padding: 6px;\n      border-radius: var(--ar-radius-xs);\n      font-size: 14px;\n      transition: var(--ar-transition);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 32px;\n      height: 32px;\n    }\n\n    .ar-icon-btn:hover { background: var(--ar-bg-hover); color: var(--ar-text); }\n\n    /* ===== ‰∏ª‰Ωì ===== */\n    #ar-body { padding: 16px; max-height: calc(90vh - 60px); overflow-y: auto; }\n    #ar-body::-webkit-scrollbar { width: 6px; }\n    #ar-body::-webkit-scrollbar-thumb { background: var(--ar-border); border-radius: 3px; }\n\n    /* ===== ÁªüËÆ°Âç°Áâá ===== */\n    #ar-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }\n\n    .ar-stat-card {\n      background: var(--ar-bg-secondary);\n      padding: 12px 8px;\n      border-radius: var(--ar-radius-sm);\n      text-align: center;\n      border: 1px solid var(--ar-border-light);\n      transition: var(--ar-transition);\n    }\n\n    .ar-stat-card:hover { border-color: var(--ar-border); transform: translateY(-1px); }\n\n    .ar-stat-value {\n      font-size: 18px;\n      font-weight: 700;\n      line-height: 1.2;\n      font-family: 'SF Mono', 'Consolas', monospace;\n    }\n\n    .ar-stat-card:nth-child(1) .ar-stat-value { color: var(--ar-accent); }\n    .ar-stat-card:nth-child(2) .ar-stat-value { color: var(--ar-purple); }\n    .ar-stat-card:nth-child(3) .ar-stat-value { color: var(--ar-success); }\n    .ar-stat-card:nth-child(4) .ar-stat-value { color: var(--ar-cyan); }\n\n    .ar-stat-label {\n      font-size: 10px;\n      color: var(--ar-text-muted);\n      margin-top: 4px;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n\n    /* ===== ËøõÂ∫¶Âå∫Âüü ===== */\n    #ar-progress-container {\n      margin-bottom: 16px;\n      background: var(--ar-bg-secondary);\n      padding: 12px;\n      border-radius: var(--ar-radius-sm);\n      border: 1px solid var(--ar-border-light);\n    }\n\n    #ar-progress-bar { height: 6px; background: var(--ar-bg-tertiary); border-radius: 3px; overflow: hidden; }\n\n    #ar-progress-fill {\n      height: 100%;\n      width: 0%;\n      background: linear-gradient(90deg, var(--ar-accent), var(--ar-purple), var(--ar-success));\n      background-size: 200% 100%;\n      border-radius: 3px;\n      transition: width 0.3s ease;\n      animation: progressGradient 3s ease infinite;\n    }\n\n    @keyframes progressGradient {\n      0%, 100% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n    }\n\n    #ar-progress-info { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 11px; }\n    #ar-progress-text { color: var(--ar-text-secondary); }\n    #ar-current-topic { color: var(--ar-text-muted); max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n\n    /* ===== ÊéßÂà∂ÊåâÈíÆ ===== */\n    #ar-controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }\n\n    .ar-btn {\n      padding: 10px 8px;\n      border: none;\n      border-radius: var(--ar-radius-sm);\n      cursor: pointer;\n      font-size: 11px;\n      font-weight: 600;\n      transition: var(--ar-transition);\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 4px;\n      position: relative;\n      overflow: hidden;\n    }\n\n    .ar-btn::before {\n      content: '';\n      position: absolute;\n      top: 0; left: 0; right: 0; bottom: 0;\n      background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 100%);\n      opacity: 0;\n      transition: opacity 0.2s;\n    }\n\n    .ar-btn:hover::before { opacity: 1; }\n    .ar-btn-icon { font-size: 16px; }\n\n    .ar-btn-primary { background: linear-gradient(135deg, var(--ar-success), #2ea043); color: white; }\n    .ar-btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px var(--ar-success-dim); }\n\n    .ar-btn-secondary { background: var(--ar-bg-secondary); color: var(--ar-text); border: 1px solid var(--ar-border); }\n    .ar-btn-secondary:hover:not(:disabled) { background: var(--ar-bg-tertiary); border-color: var(--ar-text-muted); }\n\n    .ar-btn-warning { background: linear-gradient(135deg, var(--ar-warning), #bf8700); color: white; }\n    .ar-btn-danger { background: linear-gradient(135deg, var(--ar-error), #da3633); color: white; }\n\n    .ar-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; box-shadow: none !important; }\n\n    /* ===== Ê†áÁ≠æÈ°µ ===== */\n    #ar-tabs {\n      display: flex;\n      gap: 4px;\n      margin-bottom: 12px;\n      background: var(--ar-bg-secondary);\n      padding: 4px;\n      border-radius: var(--ar-radius-sm);\n      border: 1px solid var(--ar-border-light);\n    }\n\n    .ar-tab {\n      flex: 1;\n      padding: 8px 6px;\n      border: none;\n      background: transparent;\n      color: var(--ar-text-secondary);\n      cursor: pointer;\n      border-radius: var(--ar-radius-xs);\n      font-size: 11px;\n      font-weight: 500;\n      transition: var(--ar-transition);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 4px;\n    }\n\n    .ar-tab:hover { color: var(--ar-text); background: var(--ar-bg-tertiary); }\n    .ar-tab.active { background: var(--ar-bg); color: var(--ar-accent); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); }\n\n    /* ===== ÂÜÖÂÆπÂå∫Âüü ===== */\n    .ar-tab-content {\n      display: none;\n      max-height: 280px;\n      overflow-y: auto;\n      background: var(--ar-bg-secondary);\n      border-radius: var(--ar-radius-sm);\n      border: 1px solid var(--ar-border-light);\n    }\n\n    .ar-tab-content.active { display: block; }\n    .ar-tab-content::-webkit-scrollbar { width: 6px; }\n    .ar-tab-content::-webkit-scrollbar-thumb { background: var(--ar-border); border-radius: 3px; }\n\n    /* ===== Êó•Âøó ===== */\n    #ar-logs { padding: 8px; }\n\n    .ar-log-item {\n      padding: 8px 10px;\n      border-radius: var(--ar-radius-xs);\n      margin-bottom: 4px;\n      font-size: 11px;\n      display: flex;\n      align-items: flex-start;\n      gap: 10px;\n      line-height: 1.5;\n      background: var(--ar-bg-tertiary);\n      border-left: 3px solid transparent;\n      animation: logSlideIn 0.2s ease;\n    }\n\n    @keyframes logSlideIn {\n      from { opacity: 0; transform: translateX(-10px); }\n      to { opacity: 1; transform: translateX(0); }\n    }\n\n    .ar-log-item.info { border-left-color: var(--ar-accent); }\n    .ar-log-item.success { border-left-color: var(--ar-success); }\n    .ar-log-item.warning { border-left-color: var(--ar-warning); }\n    .ar-log-item.error { border-left-color: var(--ar-error); }\n\n    .ar-log-time { color: var(--ar-text-muted); font-size: 10px; font-family: 'SF Mono', monospace; flex-shrink: 0; }\n    .ar-log-msg { flex: 1; word-break: break-word; }\n\n    .ar-log-item.info .ar-log-msg { color: var(--ar-text); }\n    .ar-log-item.success .ar-log-msg { color: var(--ar-success); }\n    .ar-log-item.warning .ar-log-msg { color: var(--ar-warning); }\n    .ar-log-item.error .ar-log-msg { color: var(--ar-error); }\n\n    /* ===== Â∏ñÂ≠êÂàóË°® ===== */\n    #ar-topics { padding: 6px; }\n\n    .ar-topic-item {\n      padding: 10px 12px;\n      border-radius: var(--ar-radius-xs);\n      margin-bottom: 4px;\n      transition: var(--ar-transition);\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      background: var(--ar-bg-tertiary);\n    }\n\n    .ar-topic-item:hover { background: var(--ar-bg-hover); }\n    .ar-topic-item.current { background: var(--ar-accent-dim); border: 1px solid var(--ar-accent); }\n\n    .ar-topic-badge {\n      font-size: 9px;\n      padding: 2px 6px;\n      border-radius: 4px;\n      flex-shrink: 0;\n      font-weight: 600;\n      text-transform: uppercase;\n    }\n\n    .ar-topic-badge.unseen { background: var(--ar-success-dim); color: var(--ar-success); border: 1px solid var(--ar-success); }\n    .ar-topic-badge.read { background: var(--ar-bg-hover); color: var(--ar-text-muted); }\n\n    .ar-topic-item a {\n      color: var(--ar-text);\n      text-decoration: none;\n      flex: 1;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      font-size: 12px;\n    }\n\n    .ar-topic-item a:hover { color: var(--ar-accent); }\n\n    .ar-topic-replies {\n      font-size: 10px;\n      color: var(--ar-text-muted);\n      flex-shrink: 0;\n      background: var(--ar-bg-secondary);\n      padding: 2px 6px;\n      border-radius: 4px;\n    }\n\n    /* ===== ËÆæÁΩÆÈù¢Êùø ===== */\n    #ar-settings { padding: 12px; }\n\n    .ar-setting-section { margin-bottom: 20px; }\n    .ar-setting-section:last-child { margin-bottom: 0; }\n\n    .ar-setting-section-title {\n      font-size: 11px;\n      color: var(--ar-text-muted);\n      text-transform: uppercase;\n      letter-spacing: 1px;\n      margin-bottom: 12px;\n      padding-bottom: 8px;\n      border-bottom: 1px solid var(--ar-border-light);\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n\n    /* Ê®°ÂºèÈÄâÊã©Âô® */\n    .ar-mode-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px; }\n\n    .ar-mode-card {\n      padding: 12px 8px;\n      border: 2px solid var(--ar-border);\n      border-radius: var(--ar-radius-sm);\n      cursor: pointer;\n      transition: var(--ar-transition);\n      text-align: center;\n      background: var(--ar-bg-tertiary);\n    }\n\n    .ar-mode-card:hover { border-color: var(--ar-text-muted); background: var(--ar-bg-hover); }\n    .ar-mode-card.active { border-color: var(--ar-accent); background: var(--ar-accent-dim); }\n\n    .ar-mode-card-icon { font-size: 20px; margin-bottom: 4px; }\n    .ar-mode-card-name { font-size: 11px; font-weight: 600; color: var(--ar-text); margin-bottom: 2px; }\n    .ar-mode-card-desc { font-size: 9px; color: var(--ar-text-muted); }\n\n    /* ËÆæÁΩÆÈ°π */\n    .ar-setting-item {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 10px 0;\n      border-bottom: 1px solid var(--ar-border-light);\n    }\n\n    .ar-setting-item:last-child { border-bottom: none; }\n    .ar-setting-label { font-size: 12px; color: var(--ar-text); font-weight: 500; }\n    .ar-setting-desc { font-size: 10px; color: var(--ar-text-muted); margin-top: 2px; }\n\n    /* ÂºÄÂÖ≥ */\n    .ar-switch { position: relative; width: 40px; height: 22px; flex-shrink: 0; }\n    .ar-switch input { opacity: 0; width: 0; height: 0; }\n\n    .ar-switch-slider {\n      position: absolute;\n      cursor: pointer;\n      top: 0; left: 0; right: 0; bottom: 0;\n      background: var(--ar-border);\n      border-radius: 11px;\n      transition: 0.3s;\n    }\n\n    .ar-switch-slider:before {\n      position: absolute;\n      content: \"\";\n      height: 16px;\n      width: 16px;\n      left: 3px;\n      bottom: 3px;\n      background: white;\n      border-radius: 50%;\n      transition: 0.3s;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n    }\n\n    .ar-switch input:checked + .ar-switch-slider { background: var(--ar-accent); }\n    .ar-switch input:checked + .ar-switch-slider:before { transform: translateX(18px); }\n\n    /* ÊªëÂùó */\n    .ar-slider-container { display: flex; align-items: center; gap: 10px; }\n\n    .ar-slider {\n      -webkit-appearance: none;\n      width: 100px;\n      height: 6px;\n      border-radius: 3px;\n      background: var(--ar-border);\n      outline: none;\n    }\n\n    .ar-slider::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      width: 16px;\n      height: 16px;\n      border-radius: 50%;\n      background: var(--ar-accent);\n      cursor: pointer;\n      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n      transition: transform 0.2s;\n    }\n\n    .ar-slider::-webkit-slider-thumb:hover { transform: scale(1.1); }\n\n    .ar-slider-value {\n      font-size: 11px;\n      color: var(--ar-accent);\n      font-weight: 600;\n      min-width: 30px;\n      text-align: right;\n      font-family: monospace;\n    }\n\n    /* ËæìÂÖ•Ê°Ü */\n    .ar-input {\n      padding: 6px 10px;\n      border: 1px solid var(--ar-border);\n      border-radius: var(--ar-radius-xs);\n      background: var(--ar-bg);\n      color: var(--ar-text);\n      font-size: 12px;\n      width: 80px;\n      outline: none;\n      transition: var(--ar-transition);\n    }\n\n    .ar-input:focus { border-color: var(--ar-accent); }\n\n    /* ËåÉÂõ¥ËæìÂÖ• */\n    .ar-range-input { display: flex; align-items: center; gap: 6px; }\n    .ar-range-input .ar-input { width: 60px; text-align: center; }\n    .ar-range-separator { color: var(--ar-text-muted); font-size: 11px; }\n\n    /* ÊåâÈíÆÁªÑ */\n    .ar-btn-row { display: flex; gap: 8px; margin-top: 12px; }\n    .ar-btn-row .ar-btn { flex: 1; flex-direction: row; padding: 10px 12px; }\n\n    /* Á©∫Áä∂ÊÄÅ */\n    .ar-empty { text-align: center; padding: 40px 20px; color: var(--ar-text-muted); }\n    .ar-empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }\n    .ar-empty-text { font-size: 12px; }\n\n    /* ÊäòÂè†Âå∫Âüü */\n    .ar-collapsible { margin-top: 12px; }\n\n    .ar-collapsible-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 10px 12px;\n      background: var(--ar-bg-tertiary);\n      border-radius: var(--ar-radius-xs);\n      cursor: pointer;\n      transition: var(--ar-transition);\n    }\n\n    .ar-collapsible-header:hover { background: var(--ar-bg-hover); }\n\n    .ar-collapsible-title { font-size: 11px; font-weight: 600; color: var(--ar-text); display: flex; align-items: center; gap: 6px; }\n    .ar-collapsible-icon { transition: transform 0.2s; }\n    .ar-collapsible.open .ar-collapsible-icon { transform: rotate(180deg); }\n\n    .ar-collapsible-content {\n      display: none;\n      padding: 12px;\n      border: 1px solid var(--ar-border-light);\n      border-top: none;\n      border-radius: 0 0 var(--ar-radius-xs) var(--ar-radius-xs);\n      background: var(--ar-bg-secondary);\n    }\n\n    .ar-collapsible.open .ar-collapsible-content { display: block; }\n\n    /* Âø´Êç∑ÈîÆÂºπÁ™ó */\n    #ar-shortcuts {\n      position: absolute;\n      bottom: 100%;\n      right: 0;\n      width: 220px;\n      background: var(--ar-bg);\n      border: 1px solid var(--ar-border);\n      border-radius: var(--ar-radius-md);\n      padding: 12px;\n      margin-bottom: 8px;\n      display: none;\n      box-shadow: var(--ar-shadow);\n    }\n\n    #ar-shortcuts.show { display: block; animation: fadeIn 0.2s ease; }\n\n    @keyframes fadeIn {\n      from { opacity: 0; transform: translateY(10px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n\n    .ar-shortcuts-title {\n      font-size: 11px;\n      font-weight: 600;\n      color: var(--ar-text);\n      margin-bottom: 10px;\n      padding-bottom: 8px;\n      border-bottom: 1px solid var(--ar-border-light);\n    }\n\n    .ar-shortcut-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 5px 0;\n      font-size: 11px;\n      color: var(--ar-text-secondary);\n    }\n\n    .ar-shortcut-key {\n      background: var(--ar-bg-secondary);\n      padding: 3px 8px;\n      border-radius: 4px;\n      font-family: monospace;\n      border: 1px solid var(--ar-border);\n      font-size: 10px;\n      color: var(--ar-text);\n    }\n\n    /* Â∑•ÂÖ∑ÊèêÁ§∫ */\n    .ar-tooltip { position: relative; }\n\n    .ar-tooltip::after {\n      content: attr(data-tooltip);\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      padding: 6px 10px;\n      background: var(--ar-bg);\n      color: var(--ar-text);\n      font-size: 11px;\n      border-radius: var(--ar-radius-xs);\n      white-space: nowrap;\n      opacity: 0;\n      visibility: hidden;\n      transition: all 0.2s;\n      border: 1px solid var(--ar-border);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n      z-index: 1000;\n      margin-bottom: 6px;\n    }\n\n    .ar-tooltip:hover::after { opacity: 1; visibility: visible; }\n  ");else{const n=document.createElement("style");n.textContent="\n    /* ===== CSS ÂèòÈáè ===== */\n    :root {\n      --ar-bg: rgba(13, 17, 23, 0.98);\n      --ar-bg-secondary: rgba(22, 27, 34, 0.95);\n      --ar-bg-tertiary: rgba(33, 38, 45, 0.9);\n      --ar-bg-hover: rgba(48, 54, 61, 0.8);\n      --ar-border: rgba(48, 54, 61, 0.6);\n      --ar-border-light: rgba(48, 54, 61, 0.3);\n      --ar-text: #e6edf3;\n      --ar-text-secondary: #8b949e;\n      --ar-text-muted: #6e7681;\n      --ar-accent: #58a6ff;\n      --ar-accent-dim: rgba(88, 166, 255, 0.15);\n      --ar-success: #3fb950;\n      --ar-success-dim: rgba(63, 185, 80, 0.15);\n      --ar-warning: #d29922;\n      --ar-warning-dim: rgba(210, 153, 34, 0.15);\n      --ar-error: #f85149;\n      --ar-error-dim: rgba(248, 81, 73, 0.15);\n      --ar-purple: #a371f7;\n      --ar-cyan: #39d4d4;\n      --ar-shadow: 0 16px 70px rgba(0, 0, 0, 0.5);\n      --ar-radius: 16px;\n      --ar-radius-md: 12px;\n      --ar-radius-sm: 8px;\n      --ar-radius-xs: 6px;\n      --ar-transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .ar-light {\n      --ar-bg: rgba(255, 255, 255, 0.98);\n      --ar-bg-secondary: rgba(246, 248, 250, 0.95);\n      --ar-bg-tertiary: rgba(234, 238, 242, 0.9);\n      --ar-bg-hover: rgba(208, 215, 222, 0.6);\n      --ar-border: rgba(208, 215, 222, 0.8);\n      --ar-border-light: rgba(208, 215, 222, 0.4);\n      --ar-text: #24292f;\n      --ar-text-secondary: #57606a;\n      --ar-text-muted: #8c959f;\n      --ar-shadow: 0 16px 70px rgba(0, 0, 0, 0.12);\n    }\n\n    /* ===== ‰∏ªÂÆπÂô® ===== */\n    #ar-panel {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 400px;\n      background: var(--ar-bg);\n      color: var(--ar-text);\n      border-radius: var(--ar-radius);\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', sans-serif;\n      font-size: 13px;\n      z-index: 99999;\n      box-shadow: var(--ar-shadow);\n      backdrop-filter: blur(20px);\n      border: 1px solid var(--ar-border);\n      transition: var(--ar-transition);\n      overflow: hidden;\n      max-height: 90vh;\n    }\n\n    #ar-panel.minimized { width: 240px; }\n    #ar-panel.minimized #ar-body { display: none; }\n\n    /* ===== Â§¥ÈÉ® ===== */\n    #ar-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 14px 16px;\n      background: var(--ar-bg-secondary);\n      cursor: move;\n      user-select: none;\n      border-bottom: 1px solid var(--ar-border);\n    }\n\n    #ar-title-section { display: flex; align-items: center; gap: 10px; }\n\n    #ar-status-dot {\n      width: 10px;\n      height: 10px;\n      border-radius: 50%;\n      background: var(--ar-text-muted);\n      transition: var(--ar-transition);\n      flex-shrink: 0;\n    }\n\n    #ar-status-dot.running {\n      background: var(--ar-success);\n      box-shadow: 0 0 0 3px var(--ar-success-dim);\n      animation: statusPulse 2s ease-in-out infinite;\n    }\n\n    #ar-status-dot.paused {\n      background: var(--ar-warning);\n      box-shadow: 0 0 0 3px var(--ar-warning-dim);\n    }\n\n    @keyframes statusPulse {\n      0%, 100% { transform: scale(1); opacity: 1; }\n      50% { transform: scale(1.1); opacity: 0.8; }\n    }\n\n    #ar-title { font-weight: 600; font-size: 14px; }\n\n    #ar-mode-badge {\n      font-size: 11px;\n      padding: 3px 10px;\n      background: var(--ar-accent-dim);\n      color: var(--ar-accent);\n      border-radius: 20px;\n      font-weight: 500;\n      border: 1px solid var(--ar-accent);\n    }\n\n    #ar-header-controls { display: flex; gap: 4px; }\n\n    .ar-icon-btn {\n      background: transparent;\n      border: none;\n      color: var(--ar-text-secondary);\n      cursor: pointer;\n      padding: 6px;\n      border-radius: var(--ar-radius-xs);\n      font-size: 14px;\n      transition: var(--ar-transition);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      width: 32px;\n      height: 32px;\n    }\n\n    .ar-icon-btn:hover { background: var(--ar-bg-hover); color: var(--ar-text); }\n\n    /* ===== ‰∏ª‰Ωì ===== */\n    #ar-body { padding: 16px; max-height: calc(90vh - 60px); overflow-y: auto; }\n    #ar-body::-webkit-scrollbar { width: 6px; }\n    #ar-body::-webkit-scrollbar-thumb { background: var(--ar-border); border-radius: 3px; }\n\n    /* ===== ÁªüËÆ°Âç°Áâá ===== */\n    #ar-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }\n\n    .ar-stat-card {\n      background: var(--ar-bg-secondary);\n      padding: 12px 8px;\n      border-radius: var(--ar-radius-sm);\n      text-align: center;\n      border: 1px solid var(--ar-border-light);\n      transition: var(--ar-transition);\n    }\n\n    .ar-stat-card:hover { border-color: var(--ar-border); transform: translateY(-1px); }\n\n    .ar-stat-value {\n      font-size: 18px;\n      font-weight: 700;\n      line-height: 1.2;\n      font-family: 'SF Mono', 'Consolas', monospace;\n    }\n\n    .ar-stat-card:nth-child(1) .ar-stat-value { color: var(--ar-accent); }\n    .ar-stat-card:nth-child(2) .ar-stat-value { color: var(--ar-purple); }\n    .ar-stat-card:nth-child(3) .ar-stat-value { color: var(--ar-success); }\n    .ar-stat-card:nth-child(4) .ar-stat-value { color: var(--ar-cyan); }\n\n    .ar-stat-label {\n      font-size: 10px;\n      color: var(--ar-text-muted);\n      margin-top: 4px;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n\n    /* ===== ËøõÂ∫¶Âå∫Âüü ===== */\n    #ar-progress-container {\n      margin-bottom: 16px;\n      background: var(--ar-bg-secondary);\n      padding: 12px;\n      border-radius: var(--ar-radius-sm);\n      border: 1px solid var(--ar-border-light);\n    }\n\n    #ar-progress-bar { height: 6px; background: var(--ar-bg-tertiary); border-radius: 3px; overflow: hidden; }\n\n    #ar-progress-fill {\n      height: 100%;\n      width: 0%;\n      background: linear-gradient(90deg, var(--ar-accent), var(--ar-purple), var(--ar-success));\n      background-size: 200% 100%;\n      border-radius: 3px;\n      transition: width 0.3s ease;\n      animation: progressGradient 3s ease infinite;\n    }\n\n    @keyframes progressGradient {\n      0%, 100% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n    }\n\n    #ar-progress-info { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 11px; }\n    #ar-progress-text { color: var(--ar-text-secondary); }\n    #ar-current-topic { color: var(--ar-text-muted); max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n\n    /* ===== ÊéßÂà∂ÊåâÈíÆ ===== */\n    #ar-controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }\n\n    .ar-btn {\n      padding: 10px 8px;\n      border: none;\n      border-radius: var(--ar-radius-sm);\n      cursor: pointer;\n      font-size: 11px;\n      font-weight: 600;\n      transition: var(--ar-transition);\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      gap: 4px;\n      position: relative;\n      overflow: hidden;\n    }\n\n    .ar-btn::before {\n      content: '';\n      position: absolute;\n      top: 0; left: 0; right: 0; bottom: 0;\n      background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 100%);\n      opacity: 0;\n      transition: opacity 0.2s;\n    }\n\n    .ar-btn:hover::before { opacity: 1; }\n    .ar-btn-icon { font-size: 16px; }\n\n    .ar-btn-primary { background: linear-gradient(135deg, var(--ar-success), #2ea043); color: white; }\n    .ar-btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px var(--ar-success-dim); }\n\n    .ar-btn-secondary { background: var(--ar-bg-secondary); color: var(--ar-text); border: 1px solid var(--ar-border); }\n    .ar-btn-secondary:hover:not(:disabled) { background: var(--ar-bg-tertiary); border-color: var(--ar-text-muted); }\n\n    .ar-btn-warning { background: linear-gradient(135deg, var(--ar-warning), #bf8700); color: white; }\n    .ar-btn-danger { background: linear-gradient(135deg, var(--ar-error), #da3633); color: white; }\n\n    .ar-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; box-shadow: none !important; }\n\n    /* ===== Ê†áÁ≠æÈ°µ ===== */\n    #ar-tabs {\n      display: flex;\n      gap: 4px;\n      margin-bottom: 12px;\n      background: var(--ar-bg-secondary);\n      padding: 4px;\n      border-radius: var(--ar-radius-sm);\n      border: 1px solid var(--ar-border-light);\n    }\n\n    .ar-tab {\n      flex: 1;\n      padding: 8px 6px;\n      border: none;\n      background: transparent;\n      color: var(--ar-text-secondary);\n      cursor: pointer;\n      border-radius: var(--ar-radius-xs);\n      font-size: 11px;\n      font-weight: 500;\n      transition: var(--ar-transition);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 4px;\n    }\n\n    .ar-tab:hover { color: var(--ar-text); background: var(--ar-bg-tertiary); }\n    .ar-tab.active { background: var(--ar-bg); color: var(--ar-accent); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); }\n\n    /* ===== ÂÜÖÂÆπÂå∫Âüü ===== */\n    .ar-tab-content {\n      display: none;\n      max-height: 280px;\n      overflow-y: auto;\n      background: var(--ar-bg-secondary);\n      border-radius: var(--ar-radius-sm);\n      border: 1px solid var(--ar-border-light);\n    }\n\n    .ar-tab-content.active { display: block; }\n    .ar-tab-content::-webkit-scrollbar { width: 6px; }\n    .ar-tab-content::-webkit-scrollbar-thumb { background: var(--ar-border); border-radius: 3px; }\n\n    /* ===== Êó•Âøó ===== */\n    #ar-logs { padding: 8px; }\n\n    .ar-log-item {\n      padding: 8px 10px;\n      border-radius: var(--ar-radius-xs);\n      margin-bottom: 4px;\n      font-size: 11px;\n      display: flex;\n      align-items: flex-start;\n      gap: 10px;\n      line-height: 1.5;\n      background: var(--ar-bg-tertiary);\n      border-left: 3px solid transparent;\n      animation: logSlideIn 0.2s ease;\n    }\n\n    @keyframes logSlideIn {\n      from { opacity: 0; transform: translateX(-10px); }\n      to { opacity: 1; transform: translateX(0); }\n    }\n\n    .ar-log-item.info { border-left-color: var(--ar-accent); }\n    .ar-log-item.success { border-left-color: var(--ar-success); }\n    .ar-log-item.warning { border-left-color: var(--ar-warning); }\n    .ar-log-item.error { border-left-color: var(--ar-error); }\n\n    .ar-log-time { color: var(--ar-text-muted); font-size: 10px; font-family: 'SF Mono', monospace; flex-shrink: 0; }\n    .ar-log-msg { flex: 1; word-break: break-word; }\n\n    .ar-log-item.info .ar-log-msg { color: var(--ar-text); }\n    .ar-log-item.success .ar-log-msg { color: var(--ar-success); }\n    .ar-log-item.warning .ar-log-msg { color: var(--ar-warning); }\n    .ar-log-item.error .ar-log-msg { color: var(--ar-error); }\n\n    /* ===== Â∏ñÂ≠êÂàóË°® ===== */\n    #ar-topics { padding: 6px; }\n\n    .ar-topic-item {\n      padding: 10px 12px;\n      border-radius: var(--ar-radius-xs);\n      margin-bottom: 4px;\n      transition: var(--ar-transition);\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      background: var(--ar-bg-tertiary);\n    }\n\n    .ar-topic-item:hover { background: var(--ar-bg-hover); }\n    .ar-topic-item.current { background: var(--ar-accent-dim); border: 1px solid var(--ar-accent); }\n\n    .ar-topic-badge {\n      font-size: 9px;\n      padding: 2px 6px;\n      border-radius: 4px;\n      flex-shrink: 0;\n      font-weight: 600;\n      text-transform: uppercase;\n    }\n\n    .ar-topic-badge.unseen { background: var(--ar-success-dim); color: var(--ar-success); border: 1px solid var(--ar-success); }\n    .ar-topic-badge.read { background: var(--ar-bg-hover); color: var(--ar-text-muted); }\n\n    .ar-topic-item a {\n      color: var(--ar-text);\n      text-decoration: none;\n      flex: 1;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      font-size: 12px;\n    }\n\n    .ar-topic-item a:hover { color: var(--ar-accent); }\n\n    .ar-topic-replies {\n      font-size: 10px;\n      color: var(--ar-text-muted);\n      flex-shrink: 0;\n      background: var(--ar-bg-secondary);\n      padding: 2px 6px;\n      border-radius: 4px;\n    }\n\n    /* ===== ËÆæÁΩÆÈù¢Êùø ===== */\n    #ar-settings { padding: 12px; }\n\n    .ar-setting-section { margin-bottom: 20px; }\n    .ar-setting-section:last-child { margin-bottom: 0; }\n\n    .ar-setting-section-title {\n      font-size: 11px;\n      color: var(--ar-text-muted);\n      text-transform: uppercase;\n      letter-spacing: 1px;\n      margin-bottom: 12px;\n      padding-bottom: 8px;\n      border-bottom: 1px solid var(--ar-border-light);\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n\n    /* Ê®°ÂºèÈÄâÊã©Âô® */\n    .ar-mode-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px; }\n\n    .ar-mode-card {\n      padding: 12px 8px;\n      border: 2px solid var(--ar-border);\n      border-radius: var(--ar-radius-sm);\n      cursor: pointer;\n      transition: var(--ar-transition);\n      text-align: center;\n      background: var(--ar-bg-tertiary);\n    }\n\n    .ar-mode-card:hover { border-color: var(--ar-text-muted); background: var(--ar-bg-hover); }\n    .ar-mode-card.active { border-color: var(--ar-accent); background: var(--ar-accent-dim); }\n\n    .ar-mode-card-icon { font-size: 20px; margin-bottom: 4px; }\n    .ar-mode-card-name { font-size: 11px; font-weight: 600; color: var(--ar-text); margin-bottom: 2px; }\n    .ar-mode-card-desc { font-size: 9px; color: var(--ar-text-muted); }\n\n    /* ËÆæÁΩÆÈ°π */\n    .ar-setting-item {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 10px 0;\n      border-bottom: 1px solid var(--ar-border-light);\n    }\n\n    .ar-setting-item:last-child { border-bottom: none; }\n    .ar-setting-label { font-size: 12px; color: var(--ar-text); font-weight: 500; }\n    .ar-setting-desc { font-size: 10px; color: var(--ar-text-muted); margin-top: 2px; }\n\n    /* ÂºÄÂÖ≥ */\n    .ar-switch { position: relative; width: 40px; height: 22px; flex-shrink: 0; }\n    .ar-switch input { opacity: 0; width: 0; height: 0; }\n\n    .ar-switch-slider {\n      position: absolute;\n      cursor: pointer;\n      top: 0; left: 0; right: 0; bottom: 0;\n      background: var(--ar-border);\n      border-radius: 11px;\n      transition: 0.3s;\n    }\n\n    .ar-switch-slider:before {\n      position: absolute;\n      content: \"\";\n      height: 16px;\n      width: 16px;\n      left: 3px;\n      bottom: 3px;\n      background: white;\n      border-radius: 50%;\n      transition: 0.3s;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n    }\n\n    .ar-switch input:checked + .ar-switch-slider { background: var(--ar-accent); }\n    .ar-switch input:checked + .ar-switch-slider:before { transform: translateX(18px); }\n\n    /* ÊªëÂùó */\n    .ar-slider-container { display: flex; align-items: center; gap: 10px; }\n\n    .ar-slider {\n      -webkit-appearance: none;\n      width: 100px;\n      height: 6px;\n      border-radius: 3px;\n      background: var(--ar-border);\n      outline: none;\n    }\n\n    .ar-slider::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      width: 16px;\n      height: 16px;\n      border-radius: 50%;\n      background: var(--ar-accent);\n      cursor: pointer;\n      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n      transition: transform 0.2s;\n    }\n\n    .ar-slider::-webkit-slider-thumb:hover { transform: scale(1.1); }\n\n    .ar-slider-value {\n      font-size: 11px;\n      color: var(--ar-accent);\n      font-weight: 600;\n      min-width: 30px;\n      text-align: right;\n      font-family: monospace;\n    }\n\n    /* ËæìÂÖ•Ê°Ü */\n    .ar-input {\n      padding: 6px 10px;\n      border: 1px solid var(--ar-border);\n      border-radius: var(--ar-radius-xs);\n      background: var(--ar-bg);\n      color: var(--ar-text);\n      font-size: 12px;\n      width: 80px;\n      outline: none;\n      transition: var(--ar-transition);\n    }\n\n    .ar-input:focus { border-color: var(--ar-accent); }\n\n    /* ËåÉÂõ¥ËæìÂÖ• */\n    .ar-range-input { display: flex; align-items: center; gap: 6px; }\n    .ar-range-input .ar-input { width: 60px; text-align: center; }\n    .ar-range-separator { color: var(--ar-text-muted); font-size: 11px; }\n\n    /* ÊåâÈíÆÁªÑ */\n    .ar-btn-row { display: flex; gap: 8px; margin-top: 12px; }\n    .ar-btn-row .ar-btn { flex: 1; flex-direction: row; padding: 10px 12px; }\n\n    /* Á©∫Áä∂ÊÄÅ */\n    .ar-empty { text-align: center; padding: 40px 20px; color: var(--ar-text-muted); }\n    .ar-empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }\n    .ar-empty-text { font-size: 12px; }\n\n    /* ÊäòÂè†Âå∫Âüü */\n    .ar-collapsible { margin-top: 12px; }\n\n    .ar-collapsible-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 10px 12px;\n      background: var(--ar-bg-tertiary);\n      border-radius: var(--ar-radius-xs);\n      cursor: pointer;\n      transition: var(--ar-transition);\n    }\n\n    .ar-collapsible-header:hover { background: var(--ar-bg-hover); }\n\n    .ar-collapsible-title { font-size: 11px; font-weight: 600; color: var(--ar-text); display: flex; align-items: center; gap: 6px; }\n    .ar-collapsible-icon { transition: transform 0.2s; }\n    .ar-collapsible.open .ar-collapsible-icon { transform: rotate(180deg); }\n\n    .ar-collapsible-content {\n      display: none;\n      padding: 12px;\n      border: 1px solid var(--ar-border-light);\n      border-top: none;\n      border-radius: 0 0 var(--ar-radius-xs) var(--ar-radius-xs);\n      background: var(--ar-bg-secondary);\n    }\n\n    .ar-collapsible.open .ar-collapsible-content { display: block; }\n\n    /* Âø´Êç∑ÈîÆÂºπÁ™ó */\n    #ar-shortcuts {\n      position: absolute;\n      bottom: 100%;\n      right: 0;\n      width: 220px;\n      background: var(--ar-bg);\n      border: 1px solid var(--ar-border);\n      border-radius: var(--ar-radius-md);\n      padding: 12px;\n      margin-bottom: 8px;\n      display: none;\n      box-shadow: var(--ar-shadow);\n    }\n\n    #ar-shortcuts.show { display: block; animation: fadeIn 0.2s ease; }\n\n    @keyframes fadeIn {\n      from { opacity: 0; transform: translateY(10px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n\n    .ar-shortcuts-title {\n      font-size: 11px;\n      font-weight: 600;\n      color: var(--ar-text);\n      margin-bottom: 10px;\n      padding-bottom: 8px;\n      border-bottom: 1px solid var(--ar-border-light);\n    }\n\n    .ar-shortcut-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 5px 0;\n      font-size: 11px;\n      color: var(--ar-text-secondary);\n    }\n\n    .ar-shortcut-key {\n      background: var(--ar-bg-secondary);\n      padding: 3px 8px;\n      border-radius: 4px;\n      font-family: monospace;\n      border: 1px solid var(--ar-border);\n      font-size: 10px;\n      color: var(--ar-text);\n    }\n\n    /* Â∑•ÂÖ∑ÊèêÁ§∫ */\n    .ar-tooltip { position: relative; }\n\n    .ar-tooltip::after {\n      content: attr(data-tooltip);\n      position: absolute;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n      padding: 6px 10px;\n      background: var(--ar-bg);\n      color: var(--ar-text);\n      font-size: 11px;\n      border-radius: var(--ar-radius-xs);\n      white-space: nowrap;\n      opacity: 0;\n      visibility: hidden;\n      transition: all 0.2s;\n      border: 1px solid var(--ar-border);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n      z-index: 1000;\n      margin-bottom: 6px;\n    }\n\n    .ar-tooltip:hover::after { opacity: 1; visibility: visible; }\n  ",document.head.appendChild(n)}},createPanel(){const n=s[o.settings.mode],a=document.createElement("div");a.id="ar-panel",a.className="light"===o.settings.theme?"ar-light":"",o.settings.minimized&&a.classList.add("minimized"),a.innerHTML=this.getPanelHTML(n),document.body.appendChild(a),this.container=a},getPanelHTML(n){return`\n      <div id="ar-header">\n        <div id="ar-title-section">\n          <span id="ar-status-dot"></span>\n          <span id="ar-title">Auto Reader</span>\n          <span id="ar-mode-badge">${n?.icon||"‚öôÔ∏è"} ${n?.name?.replace(/^[^\s]+\s/,"")||"Ëá™ÂÆö‰πâ"}</span>\n        </div>\n        <div id="ar-header-controls">\n          <button class="ar-icon-btn" id="ar-btn-theme" title="ÂàáÊç¢‰∏ªÈ¢ò">üåì</button>\n          <button class="ar-icon-btn" id="ar-btn-help" title="Âø´Êç∑ÈîÆ">‚å®Ô∏è</button>\n          <button class="ar-icon-btn" id="ar-btn-minimize" title="ÊúÄÂ∞èÂåñ">‚ûñ</button>\n        </div>\n      </div>\n      <div id="ar-body">\n        <div id="ar-stats">\n          <div class="ar-stat-card ar-tooltip" data-tooltip="Êú¨Ê¨°‰ºöËØùÂ∑≤Ê†áËÆ∞ÁöÑÂ∏ñÂ≠êÊï∞">\n            <div class="ar-stat-value" id="ar-stat-topics">0</div>\n            <div class="ar-stat-label">Â∏ñÂ≠ê</div>\n          </div>\n          <div class="ar-stat-card ar-tooltip" data-tooltip="Êú¨Ê¨°‰ºöËØùÂ∑≤Ê†áËÆ∞ÁöÑÂõûÂ§çÊï∞">\n            <div class="ar-stat-value" id="ar-stat-replies">0</div>\n            <div class="ar-stat-label">ÂõûÂ§ç</div>\n          </div>\n          <div class="ar-stat-card ar-tooltip" data-tooltip="ËøêË°åÊó∂Èïø">\n            <div class="ar-stat-value" id="ar-stat-time">0:00</div>\n            <div class="ar-stat-label">Êó∂Èïø</div>\n          </div>\n          <div class="ar-stat-card ar-tooltip" data-tooltip="‰ªäÊó•/ÊØèÊó•‰∏äÈôê">\n            <div class="ar-stat-value" id="ar-stat-daily">0</div>\n            <div class="ar-stat-label">‰ªäÊó•</div>\n          </div>\n        </div>\n\n        <div id="ar-progress-container">\n          <div id="ar-progress-bar">\n            <div id="ar-progress-fill"></div>\n          </div>\n          <div id="ar-progress-info">\n            <span id="ar-progress-text">Â∞±Áª™</span>\n            <span id="ar-current-topic"></span>\n          </div>\n        </div>\n\n        <div id="ar-controls">\n          <button class="ar-btn ar-btn-primary" id="ar-btn-start">\n            <span class="ar-btn-icon">‚ñ∂</span>\n            <span>ÂºÄÂßã</span>\n          </button>\n          <button class="ar-btn ar-btn-warning" id="ar-btn-pause" disabled>\n            <span class="ar-btn-icon">‚è∏</span>\n            <span>ÊöÇÂÅú</span>\n          </button>\n          <button class="ar-btn ar-btn-danger" id="ar-btn-stop" disabled>\n            <span class="ar-btn-icon">‚èπ</span>\n            <span>ÂÅúÊ≠¢</span>\n          </button>\n          <button class="ar-btn ar-btn-secondary" id="ar-btn-check">\n            <span class="ar-btn-icon">üîÑ</span>\n            <span>Ê£ÄÊü•</span>\n          </button>\n        </div>\n\n        <div id="ar-tabs">\n          <button class="ar-tab active" data-tab="logs">üìã Êó•Âøó</button>\n          <button class="ar-tab" data-tab="topics">üìë Â∏ñÂ≠ê</button>\n          <button class="ar-tab" data-tab="settings">‚öôÔ∏è ËÆæÁΩÆ</button>\n        </div>\n\n        <div id="ar-logs" class="ar-tab-content active">\n          <div class="ar-empty">\n            <div class="ar-empty-icon">üì≠</div>\n            <div class="ar-empty-text">ÊöÇÊó†Êó•Âøó</div>\n          </div>\n        </div>\n\n        <div id="ar-topics" class="ar-tab-content">\n          <div class="ar-empty">\n            <div class="ar-empty-icon">üìë</div>\n            <div class="ar-empty-text">ÁÇπÂáªÂºÄÂßãËé∑ÂèñÂ∏ñÂ≠ê</div>\n          </div>\n        </div>\n\n        <div id="ar-settings" class="ar-tab-content">\n          ${this.getSettingsHTML()}\n        </div>\n      </div>\n\n      <div id="ar-shortcuts">\n        <div class="ar-shortcuts-title">‚å®Ô∏è Âø´Êç∑ÈîÆ</div>\n        <div class="ar-shortcut-item"><span>ÂºÄÂßã/ÂÅúÊ≠¢</span><span class="ar-shortcut-key">Alt + S</span></div>\n        <div class="ar-shortcut-item"><span>ÊöÇÂÅú/ÊÅ¢Â§ç</span><span class="ar-shortcut-key">Alt + P</span></div>\n        <div class="ar-shortcut-item"><span>Á´ãÂç≥Ê£ÄÊü•</span><span class="ar-shortcut-key">Alt + C</span></div>\n        <div class="ar-shortcut-item"><span>ÊúÄÂ∞èÂåñ</span><span class="ar-shortcut-key">Alt + M</span></div>\n        <div class="ar-shortcut-item"><span>ÂàáÊç¢‰∏ªÈ¢ò</span><span class="ar-shortcut-key">Alt + T</span></div>\n      </div>\n    `},getSettingsHTML:()=>`\n      <div class="ar-setting-section">\n        <div class="ar-setting-section-title">üéÆ ÈòÖËØªÊ®°Âºè</div>\n        <div class="ar-mode-grid">\n          ${Object.entries(s).map(([n,a])=>`\n            <div class="ar-mode-card ${o.settings.mode===n?"active":""}" data-mode="${n}">\n              <div class="ar-mode-card-icon">${a.icon}</div>\n              <div class="ar-mode-card-name">${a.name.replace(/^[^\s]+\s/,"")}</div>\n              <div class="ar-mode-card-desc">${a.desc}</div>\n            </div>\n          `).join("")}\n        </div>\n      </div>\n\n      <div class="ar-setting-section">\n        <div class="ar-setting-section-title">‚ö° Âø´Êç∑ËÆæÁΩÆ</div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">Âπ∂ÂèëÊï∞Èáè</div><div class="ar-setting-desc">ÂêåÊó∂Â§ÑÁêÜÁöÑÂ∏ñÂ≠êÊï∞</div></div>\n          <div class="ar-slider-container">\n            <input type="range" class="ar-slider" id="ar-setting-concurrency" min="1" max="5" value="${o.settings.concurrency}">\n            <span class="ar-slider-value" id="ar-concurrency-value">${o.settings.concurrency}</span>\n          </div>\n        </div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">ÊØèÂ∏ñÂõûÂ§çÊï∞</div><div class="ar-setting-desc">ÊØè‰∏™Â∏ñÂ≠êÊúÄÂ§öÈòÖËØªÂõûÂ§çÊï∞ (0=‰ªÖ‰∏ªÂ∏ñ)</div></div>\n          <div class="ar-slider-container">\n            <input type="range" class="ar-slider" id="ar-setting-replies" min="0" max="100" step="5" value="${o.settings.reading?.maxRepliesPerTopic||50}">\n            <span class="ar-slider-value" id="ar-replies-value">${o.settings.reading?.maxRepliesPerTopic||50}</span>\n          </div>\n        </div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">ÊâπÊ¨°Â§ßÂ∞è</div><div class="ar-setting-desc">ÊØèÊ¨°Ê£ÄÊü•Â§ÑÁêÜÁöÑÂ∏ñÂ≠êÊï∞</div></div>\n          <div class="ar-slider-container">\n            <input type="range" class="ar-slider" id="ar-setting-batch" min="1" max="20" value="${o.settings.reading?.maxTopicsPerBatch||10}">\n            <span class="ar-slider-value" id="ar-batch-value">${o.settings.reading?.maxTopicsPerBatch||10}</span>\n          </div>\n        </div>\n      </div>\n\n      <div class="ar-collapsible" id="ar-advanced-settings">\n        <div class="ar-collapsible-header">\n          <span class="ar-collapsible-title">üîß È´òÁ∫ßËÆæÁΩÆ</span>\n          <span class="ar-collapsible-icon">‚ñº</span>\n        </div>\n        <div class="ar-collapsible-content">\n          <div class="ar-setting-item">\n            <div><div class="ar-setting-label">Â∏ñÂ≠êÈó¥Èöî (Áßí)</div></div>\n            <div class="ar-range-input">\n              <input type="number" class="ar-input" id="ar-interval-topic-min" value="${Math.floor(o.settings.intervals.betweenTopics.min/1e3)}">\n              <span class="ar-range-separator">~</span>\n              <input type="number" class="ar-input" id="ar-interval-topic-max" value="${Math.floor(o.settings.intervals.betweenTopics.max/1e3)}">\n            </div>\n          </div>\n          <div class="ar-setting-item">\n            <div><div class="ar-setting-label">ÂõûÂ§çÈó¥Èöî (Áßí)</div></div>\n            <div class="ar-range-input">\n              <input type="number" class="ar-input" id="ar-interval-reply-min" value="${(o.settings.intervals.betweenReplies.min/1e3).toFixed(1)}">\n              <span class="ar-range-separator">~</span>\n              <input type="number" class="ar-input" id="ar-interval-reply-max" value="${(o.settings.intervals.betweenReplies.max/1e3).toFixed(1)}">\n            </div>\n          </div>\n          <div class="ar-setting-item">\n            <div><div class="ar-setting-label">ÊâπÊ¨°Èó¥Èöî (Áßí)</div></div>\n            <div class="ar-range-input">\n              <input type="number" class="ar-input" id="ar-interval-batch-min" value="${Math.floor(o.settings.intervals.betweenBatches.min/1e3)}">\n              <span class="ar-range-separator">~</span>\n              <input type="number" class="ar-input" id="ar-interval-batch-max" value="${Math.floor(o.settings.intervals.betweenBatches.max/1e3)}">\n            </div>\n          </div>\n          <div class="ar-setting-item">\n            <div><div class="ar-setting-label">ÈöèÊú∫Ë∑≥ËøáÊ¶ÇÁéá</div></div>\n            <div class="ar-slider-container">\n              <input type="range" class="ar-slider" id="ar-setting-skip" min="0" max="50" value="${100*(o.settings.behavior?.skipProbability||.1)}">\n              <span class="ar-slider-value" id="ar-skip-value">${Math.round(100*(o.settings.behavior?.skipProbability||.1))}%</span>\n            </div>\n          </div>\n          <div class="ar-setting-item">\n            <div><div class="ar-setting-label">ÊØèÊó•Â∏ñÂ≠ê‰∏äÈôê</div></div>\n            <input type="number" class="ar-input" id="ar-setting-daily-limit" value="${o.settings.safety?.maxDailyTopics||200}" style="width: 80px;">\n          </div>\n        </div>\n      </div>\n\n      <div class="ar-setting-section" style="margin-top: 16px;">\n        <div class="ar-setting-section-title">üîî ÈÄöÁü•‰∏éË°å‰∏∫</div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">Â£∞Èü≥ÊèêÈÜí</div></div>\n          <label class="ar-switch"><input type="checkbox" id="ar-setting-sound" ${o.settings.sound?"checked":""}><span class="ar-switch-slider"></span></label>\n        </div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">Ê°åÈù¢ÈÄöÁü•</div></div>\n          <label class="ar-switch"><input type="checkbox" id="ar-setting-notifications" ${o.settings.notifications?"checked":""}><span class="ar-switch-slider"></span></label>\n        </div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">Ëá™Âä®ÂêØÂä®</div></div>\n          <label class="ar-switch"><input type="checkbox" id="ar-setting-autostart" ${o.settings.autoStart?"checked":""}><span class="ar-switch-slider"></span></label>\n        </div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">ÈöèÊú∫È°∫Â∫è</div></div>\n          <label class="ar-switch"><input type="checkbox" id="ar-setting-random" ${o.settings.reading?.randomOrder?"checked":""}><span class="ar-switch-slider"></span></label>\n        </div>\n        <div class="ar-setting-item">\n          <div><div class="ar-setting-label">ÂÅ∂Â∞îÊöÇÂÅú</div></div>\n          <label class="ar-switch"><input type="checkbox" id="ar-setting-pause" ${o.settings.behavior?.occasionalPause?"checked":""}><span class="ar-switch-slider"></span></label>\n        </div>\n      </div>\n\n      <div class="ar-btn-row">\n        <button class="ar-btn ar-btn-secondary" id="ar-btn-clear-logs">üóëÔ∏è Ê∏ÖÈô§Êó•Âøó</button>\n        <button class="ar-btn ar-btn-secondary" id="ar-btn-reset-stats">üìä ÈáçÁΩÆÁªüËÆ°</button>\n      </div>\n    `,bindEvents(){document.getElementById("ar-btn-start").addEventListener("click",()=>this.coreRef?.start()),document.getElementById("ar-btn-pause").addEventListener("click",()=>this.coreRef?.pause()),document.getElementById("ar-btn-stop").addEventListener("click",()=>this.coreRef?.stop()),document.getElementById("ar-btn-check").addEventListener("click",()=>this.coreRef?.checkNow()),document.getElementById("ar-btn-theme").addEventListener("click",()=>this.toggleTheme()),document.getElementById("ar-btn-minimize").addEventListener("click",()=>this.toggleMinimize()),document.getElementById("ar-btn-help").addEventListener("click",()=>this.toggleShortcuts()),document.querySelectorAll(".ar-tab").forEach(n=>{n.addEventListener("click",()=>this.switchTab(n.dataset.tab))}),document.querySelectorAll(".ar-mode-card").forEach(n=>{n.addEventListener("click",()=>{document.querySelectorAll(".ar-mode-card").forEach(n=>n.classList.remove("active")),n.classList.add("active"),o.settings.mode=n.dataset.mode,this.updateModeDisplay(),l.save(),g.info(`‚úì Â∑≤ÂàáÊç¢Âà∞ ${s[o.settings.mode]?.name||"Ëá™ÂÆö‰πâÊ®°Âºè"}`)})}),document.querySelector(".ar-collapsible-header")?.addEventListener("click",()=>{document.getElementById("ar-advanced-settings").classList.toggle("open")}),this.bindSlider("ar-setting-concurrency","ar-concurrency-value",n=>{o.settings.concurrency=parseInt(n)}),this.bindSlider("ar-setting-replies","ar-replies-value",n=>{o.settings.reading.maxRepliesPerTopic=parseInt(n)}),this.bindSlider("ar-setting-batch","ar-batch-value",n=>{o.settings.reading.maxTopicsPerBatch=parseInt(n)}),this.bindSlider("ar-setting-skip","ar-skip-value",n=>{o.settings.behavior.skipProbability=parseInt(n)/100},n=>n+"%"),["ar-interval-topic-min","ar-interval-topic-max"].forEach(n=>{document.getElementById(n)?.addEventListener("change",a=>{const t=n.includes("min");o.settings.intervals.betweenTopics[t?"min":"max"]=1e3*parseFloat(a.target.value),l.save()})}),["ar-interval-reply-min","ar-interval-reply-max"].forEach(n=>{document.getElementById(n)?.addEventListener("change",a=>{const t=n.includes("min");o.settings.intervals.betweenReplies[t?"min":"max"]=1e3*parseFloat(a.target.value),l.save()})}),["ar-interval-batch-min","ar-interval-batch-max"].forEach(n=>{document.getElementById(n)?.addEventListener("change",a=>{const t=n.includes("min");o.settings.intervals.betweenBatches[t?"min":"max"]=1e3*parseFloat(a.target.value),l.save()})}),document.getElementById("ar-setting-daily-limit")?.addEventListener("change",n=>{o.settings.safety.maxDailyTopics=parseInt(n.target.value),l.save()}),Object.entries({"ar-setting-sound":"sound","ar-setting-notifications":"notifications","ar-setting-autostart":"autoStart"}).forEach(([n,a])=>{document.getElementById(n)?.addEventListener("change",n=>{o.settings[a]=n.target.checked,l.save()})}),document.getElementById("ar-setting-random")?.addEventListener("change",n=>{o.settings.reading.randomOrder=n.target.checked,l.save()}),document.getElementById("ar-setting-pause")?.addEventListener("change",n=>{o.settings.behavior.occasionalPause=n.target.checked,l.save()}),document.getElementById("ar-btn-clear-logs")?.addEventListener("click",()=>g.clear()),document.getElementById("ar-btn-reset-stats")?.addEventListener("click",()=>l.clear(this,g));const n=document.getElementById("ar-header");n?.addEventListener("mousedown",n=>this.startDrag(n)),document.addEventListener("mousemove",n=>this.onDrag(n)),document.addEventListener("mouseup",()=>this.endDrag()),document.addEventListener("keydown",n=>{if(n.altKey)switch(n.key.toLowerCase()){case"s":n.preventDefault(),o.isRunning?this.coreRef?.stop():this.coreRef?.start();break;case"p":n.preventDefault(),o.isRunning&&this.coreRef?.pause();break;case"c":n.preventDefault(),this.coreRef?.checkNow();break;case"m":n.preventDefault(),this.toggleMinimize();break;case"t":n.preventDefault(),this.toggleTheme()}}),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&o.isRunning&&!o.isPaused&&Date.now()-o.lastCheckTime>r&&this.coreRef?.doCheck()}),window.addEventListener("beforeunload",()=>l.save()),setInterval(()=>{this.updateRuntime(),this.updateDailyStats()},1e3)},bindSlider(n,a,t,e=n=>n){const r=document.getElementById(n),i=document.getElementById(a);r&&i&&(r.addEventListener("input",n=>{i.textContent=e(n.target.value)}),r.addEventListener("change",n=>{t(n.target.value),l.save()}))},startDrag(n){if(n.target.closest(".ar-icon-btn"))return;this.isDragging=!0;const a=this.container.getBoundingClientRect();this.dragOffset={x:n.clientX-a.left,y:n.clientY-a.top},this.container.style.transition="none"},onDrag(n){if(!this.isDragging)return;const a=n.clientX-this.dragOffset.x,t=n.clientY-this.dragOffset.y,e=window.innerWidth-this.container.offsetWidth,r=window.innerHeight-this.container.offsetHeight;this.container.style.left=`${Math.max(0,Math.min(a,e))}px`,this.container.style.top=`${Math.max(0,Math.min(t,r))}px`,this.container.style.right="auto",this.container.style.bottom="auto"},endDrag(){this.isDragging&&(this.isDragging=!1,this.container.style.transition="",o.settings.position={x:this.container.style.left,y:this.container.style.top},l.save())},restorePosition(){null!==o.settings.position.x&&(this.container.style.left=o.settings.position.x,this.container.style.top=o.settings.position.y,this.container.style.right="auto",this.container.style.bottom="auto")},toggleTheme(){o.settings.theme="dark"===o.settings.theme?"light":"dark",this.container.classList.toggle("ar-light"),l.save()},toggleMinimize(){o.settings.minimized=!o.settings.minimized,this.container.classList.toggle("minimized"),document.getElementById("ar-btn-minimize").textContent=o.settings.minimized?"‚ûï":"‚ûñ",l.save()},toggleShortcuts(){const n=document.getElementById("ar-shortcuts");n.classList.toggle("show"),n.classList.contains("show")&&setTimeout(()=>{const a=t=>{n.contains(t.target)||t.target.closest("#ar-btn-help")||(n.classList.remove("show"),document.removeEventListener("click",a))};document.addEventListener("click",a)},0)},switchTab(n){document.querySelectorAll(".ar-tab").forEach(n=>n.classList.remove("active")),document.querySelectorAll(".ar-tab-content").forEach(n=>n.classList.remove("active")),document.querySelector(`.ar-tab[data-tab="${n}"]`)?.classList.add("active"),document.getElementById(`ar-${n}`)?.classList.add("active")},updateModeDisplay(){const n=s[o.settings.mode],a=document.getElementById("ar-mode-badge");a&&(a.innerHTML=`${n?.icon||"‚öôÔ∏è"} ${n?.name?.replace(/^[^\s]+\s/,"")||"Ëá™ÂÆö‰πâ"}`)},updateStatus(){const n=document.getElementById("ar-status-dot"),a=document.getElementById("ar-btn-start"),t=document.getElementById("ar-btn-pause"),e=document.getElementById("ar-btn-stop");n&&(n.className="",o.isRunning&&n.classList.add(o.isPaused?"paused":"running")),a&&(a.disabled=o.isRunning),t&&(t.disabled=!o.isRunning),e&&(e.disabled=!o.isRunning);const r=t?.querySelector(".ar-btn-icon"),i=t?.querySelector("span:last-child");r&&(r.textContent=o.isPaused?"‚ñ∂":"‚è∏"),i&&(i.textContent=o.isPaused?"ÊÅ¢Â§ç":"ÊöÇÂÅú")},updateStats(){const n=document.getElementById("ar-stat-topics"),a=document.getElementById("ar-stat-replies");n&&(n.textContent=d.formatNumber(o.stats.session.topicsMarked)),a&&(a.textContent=d.formatNumber(o.stats.session.repliesMarked))},updateDailyStats(){const n=(new Date).toDateString();o.stats.daily.date!==n&&(o.stats.daily={topicsMarked:0,repliesMarked:0,date:n});const a=document.getElementById("ar-stat-daily");a&&(a.textContent=`${o.stats.daily.topicsMarked}/${o.settings.safety.maxDailyTopics}`)},updateRuntime(){if(!o.isRunning||!o.runtime.startTime)return;let n=Date.now()-o.runtime.startTime-o.runtime.pausedTime;o.isPaused&&o.runtime.lastPauseStart&&(n-=Date.now()-o.runtime.lastPauseStart);const a=document.getElementById("ar-stat-time");a&&(a.textContent=d.formatDuration(n))},updateProgress(n,a){const t=document.getElementById("ar-progress-fill"),e=document.getElementById("ar-progress-text"),r=document.getElementById("ar-current-topic");t&&(t.style.width=`${n}%`),e&&(e.textContent=a),r&&(r.textContent=o.currentTopic?d.truncate(o.currentTopic.title,25):"")},appendLog(n){const t=document.getElementById("ar-logs");if(!t)return;const e=t.querySelector(".ar-empty");e&&e.remove();const r=document.createElement("div");for(r.className=`ar-log-item ${n.type}`,r.innerHTML=`<span class="ar-log-time">${n.time}</span><span class="ar-log-msg">${n.message}</span>`,t.appendChild(r),t.scrollTop=t.scrollHeight;t.children.length>a;)t.removeChild(t.firstChild)},updateTopicsList(n){const a=document.getElementById("ar-topics");if(!a)return;a.innerHTML="";const e=n.slice(0,t);0!==e.length?e.forEach(n=>{const t=document.createElement("div");t.className="ar-topic-item "+(n.unseen?"unseen":""),t.dataset.topicId=n.id,t.innerHTML=`\n        <span class="ar-topic-badge ${n.unseen?"unseen":"read"}">${n.unseen?"Êú™ËØª":"Â∑≤ËØª"}</span>\n        <a href="https://linux.do/t/topic/${n.id}" target="_blank" title="${n.title}">${n.title}</a>\n        <span class="ar-topic-replies">${n.posts_count||0}</span>\n      `,a.appendChild(t)}):a.innerHTML='<div class="ar-empty"><div class="ar-empty-icon">üìë</div><div class="ar-empty-text">ÊöÇÊó†Â∏ñÂ≠êÊï∞ÊçÆ</div></div>'},highlightCurrentTopic(n){document.querySelectorAll(".ar-topic-item").forEach(a=>{a.classList.toggle("current",a.dataset.topicId===String(n))})}},f=x;function y(){l.load(),g.setUI(f),h.setUI(f),f.setCore(h),f.init(),(o.settings.autoStart||o.isRunning)&&setTimeout(()=>h.start(),2e3),g.success("üéâ Linux.do Auto Reader Ultimate Â∑≤Âä†ËΩΩ"),g.info(`üìñ Ê®°Âºè: ${s[o.settings.mode]?.name||"Ëá™ÂÆö‰πâ"}`),g.info(`‚ö° Âπ∂Âèë: ${o.settings.concurrency} | ÊØèÂ∏ñÂõûÂ§ç: ${o.settings.reading.maxRepliesPerTopic}`)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y()})();